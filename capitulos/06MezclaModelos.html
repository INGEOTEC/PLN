<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.371">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Procesamiento de Lenguaje Natural - 6&nbsp; Mezcla de Modelos</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../capitulos/07TareasClasificacion.html" rel="next">
<link href="../capitulos/05RepresentacionTexto.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script>
<script src="../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../capitulos/06MezclaModelos.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Mezcla de Modelos</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Procesamiento de Lenguaje Natural</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/INGEOTEC/PLN" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="../Procesamiento-de-Lenguaje-Natural.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Buscar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefacio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/01Introduccion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introducción</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/02ManejandoTexto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Manejando Texto</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/03ModeladoLenguaje.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Modelado de Lenguaje</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/04ClasificacionTexto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Fundamentos de Clasificación de Texto</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/05RepresentacionTexto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Representación de Texto</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/06MezclaModelos.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Mezcla de Modelos</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/07TareasClasificacion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Tareas de Clasificación de Texto</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/08BasesConocimiento.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Bases de Conocimiento</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/09Visualizacion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Visualización</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/10Conclusiones.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Conclusiones</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/11Referencias.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Referencias</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Tabla de contenidos</h2>
   
  <ul>
  <li><a href="#paquetes-usados" id="toc-paquetes-usados" class="nav-link active" data-scroll-target="#paquetes-usados">Paquetes usados</a></li>
  <li><a href="#introducción" id="toc-introducción" class="nav-link" data-scroll-target="#introducción"><span class="header-section-number">6.1</span> Introducción</a></li>
  <li><a href="#bolsa-de-palabras-dispersa" id="toc-bolsa-de-palabras-dispersa" class="nav-link" data-scroll-target="#bolsa-de-palabras-dispersa"><span class="header-section-number">6.2</span> Bolsa de Palabras Dispersa</a></li>
  <li><a href="#bolsa-de-palabras-densas" id="toc-bolsa-de-palabras-densas" class="nav-link" data-scroll-target="#bolsa-de-palabras-densas"><span class="header-section-number">6.3</span> Bolsa de Palabras Densas</a></li>
  <li><a href="#sec-analisis-ejemplo" id="toc-sec-analisis-ejemplo" class="nav-link" data-scroll-target="#sec-analisis-ejemplo"><span class="header-section-number">6.4</span> Análisis Mediante Ejemplos</a></li>
  <li><a href="#combinando-modelos" id="toc-combinando-modelos" class="nav-link" data-scroll-target="#combinando-modelos"><span class="header-section-number">6.5</span> Combinando Modelos</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Mezcla de Modelos</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Código</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Mostrar todo el código</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Ocultar todo el código</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">Ver el código fuente</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>

<p>El <strong>objetivo</strong> de la unidad es</p>
<section id="paquetes-usados" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="paquetes-usados">Paquetes usados</h2>
<div id="889f0958" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> EvoMSA <span class="im">import</span> BoW,<span class="op">\</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                   DenseBoW,<span class="op">\</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                   StackGeneralization</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> microtc.utils <span class="im">import</span> tweet_iterator</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IngeoML <span class="im">import</span> CI, SelectFromModelCV</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> f1_score,<span class="op">\</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                            recall_score,<span class="op">\</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>                            precision_score</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> wordcloud <span class="im">import</span> WordCloud                            </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pylab <span class="im">as</span> plt</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><strong>Video explicando la unidad</strong></p>
<hr>
</section>
<section id="introducción" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="introducción"><span class="header-section-number">6.1</span> Introducción</h2>
<div class="cell">
<div class="cell-output-display">
<div id="fig-prediccion-1-estimador" class="quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-prediccion-1-estimador-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-prediccion-1-estimador">flowchart LR
    Repr([Representación]) -- Clasificación --&gt; Clasificador[Clasificador]
    Repr -- Regresión --&gt; Regresor[Regresor]
    Clasificador --&gt; Prediccion([Predicción])
    Regresor --&gt; Prediccion
</pre>
</div>
</div>
<figcaption class="figure quarto-float-caption quarto-float-fig" id="fig-prediccion-1-estimador-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.1: Diagrama de predicción
</figcaption>
</figure>
</div>
</div>
</div>
<p>El conjunto de datos se puede conseguir en la página de <a href="https://ingeotec.github.io/Delitos">Delitos</a> aunque en esta dirección es necesario poblar los textos dado que solamente se encuentra el identificador del Tweet.</p>
<p>Para leer los datos del conjunto de entrenamiento y prueba se utilizan las siguientes instrucciones. En la variable <code>D</code> se tiene los datos que se utilizarán para entrenar el clasificador basado en la bolsa de palabras y en <code>Dtest</code> los datos del conjunto de prueba, que son usados para medir el rendimiento del clasificador.</p>
<div id="f11e7ef9" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>fname <span class="op">=</span> <span class="st">'delitos/delitos_ingeotec_Es_train.json'</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>fname_test <span class="op">=</span> <span class="st">'delitos/delitos_ingeotec_Es_test.json'</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> <span class="bu">list</span>(tweet_iterator(fname))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>Dtest <span class="op">=</span> <span class="bu">list</span>(tweet_iterator(fname_test))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En la siguiente instrucción se observa el primer elemento del conjunto de entrenamiento. Se puede observar que en el campo <code>text</code> se encuentra el texto, el campo <code>klass</code> representa la etiqueta o clase, donde <span class="math inline">\(0\)</span> representa la clase negativa y <span class="math inline">\(1\)</span> la clase positiva, es decir, la presencia de un delito. El campo <code>id</code> es el identificador del Tweet y <code>annotations</code> son las clases dadas por los etiquetadores a ese ejemplo.</p>
<div id="ae77bdbf" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>D[<span class="dv">81</span>]</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>{'annotations': [0, 0, 0],
 'id': 1107040319986696195,
 'klass': 0,
 'text': 'To loco'}</code></pre>
</div>
</div>
</section>
<section id="bolsa-de-palabras-dispersa" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="bolsa-de-palabras-dispersa"><span class="header-section-number">6.2</span> Bolsa de Palabras Dispersa</h2>
<p>Se inicia con la creación de un clasificador basado en una bolsa de palabras dispersa, el clasificador es una máquina de soporte vectorial lineal (<code>LinearSVC</code>). La siguiente instrucción usa la clase <code>BoW</code> para crear este clasificador de texto. El primer paso es seleccionar el lenguaje, en este caso español (es) y después se entrena usando el método <code>fit</code>.</p>
<div id="dfbcd45e" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>bow <span class="op">=</span> BoW(lang<span class="op">=</span><span class="st">'es'</span>).fit(D)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Habiendo entrenado el clasificador de texto es momento de utilizarlo para predecir, las siguientes dos instrucciones muestra el uso de la instancia <code>bow</code> para predecir clase del texto <em>me golpearon y robaron la bicicleta en la noche.</em> Se puede observar que la clase es <span class="math inline">\(1\)</span>, lo cual indica que el texto menciona la ejecución de un delito.</p>
<div id="4d38af3e" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>txt <span class="op">=</span> <span class="st">'me golpearon y robaron la bicicleta en la noche'</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>bow.predict([txt])</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>array([1])</code></pre>
</div>
</div>
<p>El método <code>predict</code> recibe una lista de textos a predecir, en la siguiente instrucción se predicen todas las clases del conjunto de prueba (<code>Dtest</code>), la predicciones se guardar en la variable <code>hy_bow</code>.</p>
<div id="bc5db189" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>hy_bow <span class="op">=</span> bow.predict(Dtest)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Habiendo realizado la predicciones en el conjunto de prueba (<span class="math inline">\(\mathcal D\)</span>), es momento de utilizar estas para medir el rendimiento, en esta ocasión se mide el valor <span class="math inline">\(f_1\)</span> para cada clase. El primer valor (<span class="math inline">\(0.9461\)</span>) corresponde a la medida <span class="math inline">\(f_1\)</span> en la clase negativa y el segundo (<span class="math inline">\(0.7460\)</span>) corresponde al valor en la clase positiva.</p>
<div id="4509589a" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.r_[[x[<span class="st">'klass'</span>] <span class="cf">for</span> x <span class="kw">in</span> Dtest]]</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>f1_score(y, hy_bow, average<span class="op">=</span><span class="va">None</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>array([0.94612795, 0.74603175])</code></pre>
</div>
</div>
<p>Con el objetivo de conocer la variabilidad del rendimiento del clasificador en este conjunto de datos, la siguientes instrucciones calcula el intervalo de confianza; para realizarlo se utiliza la clase <code>CI</code> la cual recibe la estadística a calcular, en este caso medida <span class="math inline">\(f_1\)</span>. El siguiente paso es llamar a la clase con las entradas para calcular el intervalo, estas corresponden a las mediciones y predicciones del conjunto de prueba.</p>
<div id="fd8b8042" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>ci <span class="op">=</span> CI(statistic<span class="op">=</span><span class="kw">lambda</span> y, hy: f1_score(y, hy, </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                                         average<span class="op">=</span><span class="va">None</span>))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>ci_izq, ci_der <span class="op">=</span> ci(y, hy_bow)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>El intervalo izquierdo es <span class="math inline">\([0.9233, 0.6502]\)</span> y el derecho tiene los valores <span class="math inline">\([0.9632, 0.8312]\)</span>. Para complementar la información del intervalo de confianza, la <a href="#fig-hist-f1-bow" class="quarto-xref">Figura&nbsp;<span>6.2</span></a> muestra el histograma y la densidad estimada para calcular el intervalo de confianza. Se ve que la varianza en la clase negativa es menor además de que tiene un rendimiento mejor que en la clase positiva.</p>
<div id="cell-fig-hist-f1-bow" class="cell" data-execution_count="13">
<details>
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df_bow <span class="op">=</span> pd.DataFrame(ci.statistic_samples, columns<span class="op">=</span>[<span class="st">'f1-neg'</span>, <span class="st">'f1-pos'</span>])</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>df_bow[<span class="st">'Tipo'</span>] <span class="op">=</span> <span class="st">'BoW'</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">'whitegrid'</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>sns.displot(df_bow, kde<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-hist-f1-bow" class="quarto-figure quarto-figure-center anchored" width="564" height="470">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-hist-f1-bow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06MezclaModelos_files/figure-html/fig-hist-f1-bow-output-1.png" width="564" height="470" class="figure-img">
</div>
<figcaption class="figure quarto-float-caption quarto-float-fig" id="fig-hist-f1-bow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.2: Histograma de f1 por clase
</figcaption>
</figure>
</div>
</div>
</div>
<p>Una manera de poder analizar el comportamiento del clasificador de texto implementado es visualizar en una nube de palabras las características que tienen el mayor peso en la decisión. Esto se realiza en las siguientes instrucciones siendo el primer paso obtener los coeficientes de la máquina de soporte vectorial lineal, los cuales se guardan en la variable <code>ws</code>. El segundo componente es el valor de IDF que tiene cada uno de los términos, esto se encuentran en el atributo <code>BoW.weights</code> tal y como se muestra en la segunda instrucción del siguiente código.</p>
<div id="b5324d0c" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ws <span class="op">=</span> bow.estimator_instance.coef_[<span class="dv">0</span>]</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>idfs <span class="op">=</span> bow.weights</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Teniendo los valores del clasificador y del IDF, solamente es necesario obtener su producto y separar los términos positivos de los negativos, tal y como se muestra en el siguiente código. La <a href="#fig-nube-tokens" class="quarto-xref">Figura&nbsp;<span>6.3</span></a> muestra las nubes de palabras generadas, cabe mencionar que aquellos términos que tienen como prefijo <code>q:</code> corresponden a q-gramas de caracteres y los términos que tienen el caracter <code>~</code> corresponden a bigramas de palabras.</p>
<div id="c1027ce0" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>tokens_pos <span class="op">=</span> {name: w <span class="op">*</span> idf</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>              <span class="cf">for</span> name, idf, w <span class="kw">in</span> <span class="bu">zip</span>(bow.names,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                                      idfs, ws)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> w <span class="op">&gt;</span> <span class="dv">0</span>}</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>tokens_neg <span class="op">=</span> {name: w <span class="op">*</span> idf <span class="op">*</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>              <span class="cf">for</span> name, idf, w <span class="kw">in</span> <span class="bu">zip</span>(bow.names,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>                                      idfs, ws)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> w <span class="op">&lt;</span> <span class="dv">0</span>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En la figura se puede observar que las características más importantes corresponden a la presencia de <em>asesinan</em>, <em>asesinan a</em>, <em>tiroteo</em> entre otras y por el lado de palabras relacionadas a la clase negativa se observan <em>secuestrado</em>, <em>asesina</em>, <em>un asesino</em>, entre otras. En <a href="#sec-analisis-ejemplo" class="quarto-xref"><span>Sección&nbsp;6.4</span></a> se muestran ejemplos que ayudan a comprender el hecho de que la palabra <em>asesinan</em> sea considerada como positiva y por otro lado <em>asesina</em> se en la clase negativa.</p>
<div id="cell-fig-nube-tokens" class="cell" data-execution_count="16">
<details>
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>word_pos <span class="op">=</span> WordCloud().generate_from_frequencies(tokens_pos)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>word_neg <span class="op">=</span> WordCloud().generate_from_frequencies(tokens_neg)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cloud, ax, title <span class="kw">in</span> <span class="bu">zip</span>([word_neg, word_pos],</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                     [ax1, ax2],</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>                     [<span class="st">'Negativas'</span>, <span class="st">'Positivas'</span>]):</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    ax.imshow(cloud, interpolation<span class="op">=</span><span class="st">'bilinear'</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    ax.grid(<span class="va">False</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(left<span class="op">=</span><span class="va">False</span>, right<span class="op">=</span><span class="va">False</span>, labelleft<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>                   labelbottom<span class="op">=</span><span class="va">False</span>, bottom<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-nube-tokens" class="quarto-figure quarto-figure-center anchored" width="540" height="157">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nube-tokens-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06MezclaModelos_files/figure-html/fig-nube-tokens-output-1.png" width="540" height="157" class="figure-img">
</div>
<figcaption class="figure quarto-float-caption quarto-float-fig" id="fig-nube-tokens-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.3: Nubes de términos positivos y negativos
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="bolsa-de-palabras-densas" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="bolsa-de-palabras-densas"><span class="header-section-number">6.3</span> Bolsa de Palabras Densas</h2>
<p>Es ahora el turno de hacer el análisis del clasificador de texto que se basado en bolsa de palabras densas. La siguiente instrucción muestra el uso de este clasificador donde se usa una bolsa de palabras con un vocabulario de <span class="math inline">\(2^{15}\)</span> (parámetro <code>voc_size_exponent=15</code>) y además se seleccionan como representaciones aquellos entrenados en los conjuntos de emojis (<code>emoji=True</code>) y las palabras claves (<code>keyword=True</code>). En esta caso, los parámetros del clasificador no son estimados, es decir, no se llama al método <code>fit</code>. Esto es porque en este ejemplo se van a seleccionar aquellas representaciones que mejor representan al problema de Delitos utilizando una máquina de soporte vectorial lineal.</p>
<div id="b42aa5b6" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>dense <span class="op">=</span> DenseBoW(lang<span class="op">=</span><span class="st">'es'</span>,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                 voc_size_exponent<span class="op">=</span><span class="dv">15</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                 emoji<span class="op">=</span><span class="va">True</span>, keyword<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                 dataset<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para seleccionar las características que mejor representan al problema de delitos se utiliza la clase <code>SelectFromModelCV</code> la cual usa los coeficientes de la máquina de soporte vectorial para seleccionar las características más representativas, estas corresponden aquellas que tienen los coeficientes más grandes tomando su valor absoluto. La selección se realiza llamando al método <code>DenseBoW.select</code> con los parámetros que se observan en las siguientes instrucciones. En particular <code>SelectFromModelCV</code> es un método supervisado entonces se utilizarán las clase del conjunto de entrenamiento, y para poder medir el rendimiento de cada conjunto de características seleccionadas se usa una validación cruzada. La última instrucción estima los valores del clasificador con las características seleccionadas.</p>
<div id="e2176073" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>macro_f1 <span class="op">=</span> <span class="kw">lambda</span> y, hy: f1_score(y, hy, average<span class="op">=</span><span class="st">'macro'</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>kwargs <span class="op">=</span> dense.estimator_kwargs</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>estimator <span class="op">=</span> dense.estimator_class(<span class="op">**</span>kwargs)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>kwargs <span class="op">=</span> <span class="bu">dict</span>(estimator<span class="op">=</span>estimator,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>              scoring<span class="op">=</span>macro_f1)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>dense.select(D<span class="op">=</span>D,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>             feature_selection<span class="op">=</span>SelectFromModelCV,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>             feature_selection_kwargs<span class="op">=</span>kwargs)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>dense.fit(D)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Como se mencionó la clase <code>SelectFromModelCV</code> selecciona aquellas características que mejor rendimiento dan, la clase mantiene los valores estimados en cada selección, las siguientes instrucciones ejemplifican como obtener los valores de rendimiento en las selecciones. La variable <code>perf</code> es una diccionario donde la llave es el número de características y el valor es el rendimiento correspondiente. La <a href="#fig-dense-k" class="quarto-xref">Figura&nbsp;<span>6.4</span></a> muestra es rendimiento se puede observar la dinámica donde con un poco menos de <span class="math inline">\(1000\)</span> características se tiene un valor de rendimiento cercano a <span class="math inline">\(0.9\)</span>.</p>
<div id="ff14db64" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>select <span class="op">=</span> dense.feature_selection</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>perf <span class="op">=</span> select.cv_results_</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-fig-dense-k" class="cell" data-execution_count="20">
<details>
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> [{<span class="st">'d'</span>: k, <span class="st">'macro-f1'</span>: v} <span class="cf">for</span> k, v <span class="kw">in</span> perf.items()]</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(_)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.lineplot(df, x<span class="op">=</span><span class="st">'d'</span>, y<span class="op">=</span><span class="st">'macro-f1'</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">'whitegrid'</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-dense-k" class="quarto-figure quarto-figure-center anchored" width="585" height="427">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dense-k-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06MezclaModelos_files/figure-html/fig-dense-k-output-1.png" width="585" height="427" class="figure-img">
</div>
<figcaption class="figure quarto-float-caption quarto-float-fig" id="fig-dense-k-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.4: Rendimiento Variando el Número de Características
</figcaption>
</figure>
</div>
</div>
</div>
<p>Después de haber seleccionado el número de características, se utiliza un código equivalente al usado en <code>BoW</code> para predecir las clases del conjunto de prueba (<span class="math inline">\(\mathcal G\)</span>), tal y como se muestra en la siguiente instrucción.</p>
<div id="ce52d3f8" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>hy_dense <span class="op">=</span> dense.predict(Dtest)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>El rendimiento en <span class="math inline">\(f_1\)</span> del clasificador basado en una bolsa se muestra con el siguiente código. Este valor puntual se complementa con la <a href="#fig-hist-f1-bow-dense" class="quarto-xref">Figura&nbsp;<span>6.5</span></a> donde se muestra la distribución de esta medición y se compara con la obtenida con el clasificador de bolsa de palabras dispersa (i.e., <code>bow</code>).</p>
<div id="9d7bdb2d" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>f1_score(y, hy_dense, average<span class="op">=</span><span class="va">None</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>array([0.94158076, 0.75362319])</code></pre>
</div>
</div>
<div id="cell-fig-hist-f1-bow-dense" class="cell" data-execution_count="23">
<details>
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>ci(y, hy_dense)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>df_dense <span class="op">=</span> pd.DataFrame(ci.statistic_samples, columns<span class="op">=</span>[<span class="st">'f1-neg'</span>, <span class="st">'f1-pos'</span>])</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>df_dense[<span class="st">'Tipo'</span>] <span class="op">=</span> <span class="st">'Dense'</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> df_bow.melt(id_vars<span class="op">=</span>[<span class="st">'Tipo'</span>], value_name<span class="op">=</span><span class="st">'value'</span>, var_name<span class="op">=</span><span class="st">'f1'</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>_2 <span class="op">=</span> df_dense.melt(id_vars<span class="op">=</span>[<span class="st">'Tipo'</span>], value_name<span class="op">=</span><span class="st">'value'</span>, var_name<span class="op">=</span><span class="st">'f1'</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> pd.concat((_, _2))</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"whitegrid"</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> sns.displot(_, x<span class="op">=</span><span class="st">'value'</span>, hue<span class="op">=</span><span class="st">'f1'</span>, kde<span class="op">=</span><span class="va">True</span>, col<span class="op">=</span><span class="st">'Tipo'</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;plt.grid()</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-hist-f1-bow-dense" class="quarto-figure quarto-figure-center anchored" width="1044" height="471">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-hist-f1-bow-dense-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06MezclaModelos_files/figure-html/fig-hist-f1-bow-dense-output-1.png" width="1044" height="471" class="figure-img">
</div>
<figcaption class="figure quarto-float-caption quarto-float-fig" id="fig-hist-f1-bow-dense-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.5: Histogramas de f1 por clase
</figcaption>
</figure>
</div>
</div>
</div>
<p>En un clasificador basado en palabras densas también se puede comprender su comportamiento mostrando aquellas características que tiene un mayor peso al momento de decidir la clase. En las siguientes instrucciones se agrupan las características positivas y las negativas, utilizando el valor estimado por la máquina de soporte vectorial lineal (<code>w</code>). Considerando que cada característica está asociada a una palabra o emoji, entonces se pueden visualizar mediante una nube de palabras.</p>
<div id="49f16d41" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> dense.estimator_instance.coef_[<span class="dv">0</span>]</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>names <span class="op">=</span> np.array(dense.names)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>carac_pos <span class="op">=</span> {k: v <span class="cf">for</span> k, v <span class="kw">in</span> <span class="bu">zip</span>(names, w) <span class="cf">if</span> v <span class="op">&gt;</span> <span class="dv">0</span>}</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>carac_neg <span class="op">=</span> {k: v <span class="op">*</span> <span class="op">-</span><span class="dv">1</span> <span class="cf">for</span> k, v <span class="kw">in</span> <span class="bu">zip</span>(names, w) <span class="cf">if</span> v <span class="op">&lt;</span> <span class="dv">0</span>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La <a href="#fig-nube-densa" class="quarto-xref">Figura&nbsp;<span>6.6</span></a> muestra las nubes de palabras de las características positivas y negativas, se puede observar que una característica significativa de la clase positiva corresponde al modelo <strong>robo</strong>, <strong>muere</strong>, entre otros y de la clase negativa se observa <strong>comentando</strong>, **ocurrir*, entre otras.</p>
<div id="cell-fig-nube-densa" class="cell" data-execution_count="25">
<details>
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>word_pos <span class="op">=</span> WordCloud().generate_from_frequencies(carac_pos)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>word_neg <span class="op">=</span> WordCloud().generate_from_frequencies(carac_neg)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cloud, ax, title <span class="kw">in</span> <span class="bu">zip</span>([word_neg, word_pos],</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>                     [ax1, ax2],</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>                     [<span class="st">'Negativas'</span>, <span class="st">'Positivas'</span>]):</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    ax.imshow(cloud, interpolation<span class="op">=</span><span class="st">'bilinear'</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    ax.grid(<span class="va">False</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(left<span class="op">=</span><span class="va">False</span>, right<span class="op">=</span><span class="va">False</span>, labelleft<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>                   labelbottom<span class="op">=</span><span class="va">False</span>, bottom<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-nube-densa" class="quarto-figure quarto-figure-center anchored" width="540" height="157">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nube-densa-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06MezclaModelos_files/figure-html/fig-nube-densa-output-1.png" width="540" height="157" class="figure-img">
</div>
<figcaption class="figure quarto-float-caption quarto-float-fig" id="fig-nube-densa-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.6: Nube de características positivas y negativas
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="sec-analisis-ejemplo" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="sec-analisis-ejemplo"><span class="header-section-number">6.4</span> Análisis Mediante Ejemplos</h2>
<p>Hasta el momento se ha presentado un análisis global de los clasificadores dispersos (<code>bow</code>) y densos (<code>dense</code>), en esta sección se especializa el análisis al nivel de ejemplos. Lo primero que se realiza es ver el valor de la función de decisión, el signo de este valor indica la clase, un valor positivo indica clase positiva y el signo negativo corresponde a la clase negativa. El valor absoluto de la función indica de manera proporcional la distancia que existe al hiperplano que define las clases. Dado que se está utilizando este valor para contrastar el comportamiento de los algoritmos entonces la distancia entre el ejemplo al hiperplano está dado por la función de decisión dividida entre la norma de los coeficientes. La primera línea calcula la norma de los coeficientes estimados tanto para el clasificador disperso (<code>bow_norm</code>) y el denso (<code>dense_norm</code>)</p>
<div id="feb32253" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>bow_norm <span class="op">=</span> np.linalg.norm(bow.estimator_instance.coef_[<span class="dv">0</span>])</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>dense_norm <span class="op">=</span> np.linalg.norm(dense.estimator_instance.coef_[<span class="dv">0</span>])</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Con las normas se procederá a calcular la función de decisión para el ejemplo <em>Asesinan a persona en Jalisco</em>, este ejemplo es positivo dado que menciona la ocurrencia de un delito. En las siguientes instrucciones se calcula la distancia al hiperplano la cual se puede observar que es positiva indicando que el texto es positivo.</p>
<div id="821047b9" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>txt <span class="op">=</span> <span class="st">'Asesinan a persona en Jalisco.'</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>bow.decision_function([txt]) <span class="op">/</span> bow_norm</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>array([[0.03104452]])</code></pre>
</div>
</div>
<p>Complementando la distancia del clasificador disperso se presenta la distancia del clasificador denso en el siguiente código. También se puede observar que su valor es positivo, pero este se encuentre más cercano al hiperplano de decisión, lo cual indica que existe una mayor incertidumbre en su clase.</p>
<div id="c52e34c9" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>dense.decision_function([txt]) <span class="op">/</span> dense_norm</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>array([[0.00906055]])</code></pre>
</div>
</div>
<p>Realizando el mismo procedimiento pero para texto <em>La asesina vivía en Jalisco.</em> Lo primero que se debe de notar es que el texto es negativo dado que se menciona que existe una asesina, pero el texto no indica que se haya cometido algún delito, esta fue una de las reglas que se siguió para etiquetar los textos tanto del conjunto de entrenamiento (<span class="math inline">\(\mathcal T\)</span>) como del conjunto de prueba (<span class="math inline">\(\mathcal G\)</span>). Pero es evidente que el texto anterior y el actual son sintácticamente muy similares, pero con una semántica diferente.</p>
<p>El siguiente código predice la función de decisión del clasificador disperso, la distancia es el valor absoluto del número presentado y el signo indica el lado del hiperplano, se observa que es negativo, entonces el clasificador indica que pertenece a la clase negativa.</p>
<div id="cf549f3a" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>txt <span class="op">=</span> <span class="st">'La asesina vivía en Jalisco.'</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>bow.decision_function([txt]) <span class="op">/</span> bow_norm</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>array([[-0.03643002]])</code></pre>
</div>
</div>
<p>El mismo procedimiento se realiza para el clasificador denso como se indica a continuación, obteniendo también un valor negativo y con una magnitud similar al encontrado por el clasificador disperso.</p>
<div id="3002f487" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>dense.decision_function([txt]) <span class="op">/</span> dense_norm</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>array([[-0.03598119]])</code></pre>
</div>
</div>
<p>Continuando con el análisis, se puede visualizar los coeficientes más significativos para realizar la predicción. Por ejemplo, las siguientes instrucciones muestran los 5 coeficientes más significativos para predecir el texto <em>Asesinan a persona en Jalisco.</em></p>
<div id="271a1705" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>txt <span class="op">=</span> <span class="st">'Asesinan a persona en Jalisco.'</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> bow.estimator_instance.coef_[<span class="dv">0</span>]</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>vec <span class="op">=</span> bow.bow[txt]</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="bu">sorted</span>([(bow.names[k], w[k] <span class="op">*</span> v) <span class="cf">for</span> k, v <span class="kw">in</span> vec],</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>       key<span class="op">=</span><span class="kw">lambda</span> x: np.fabs(x[<span class="dv">1</span>]), reverse<span class="op">=</span><span class="va">True</span>)[:<span class="dv">5</span>]</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>[('asesinan', 0.21959409949185787),
 ('asesinan~a', 0.20828280738121605),
 ('q:sina', 0.14511813536902943),
 ('q:n~a~', 0.08388029475644186),
 ('q:an~a', 0.0734437622092712)]</code></pre>
</div>
</div>
<p>Un procedimiento equivalente se realiza para el clasificador denso, tal y como se muestra en el siguiente código.</p>
<div id="bd3ebc85" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> dense.estimator_instance.coef_[<span class="dv">0</span>]</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>vec <span class="op">=</span> dense.transform([txt])[<span class="dv">0</span>] <span class="op">*</span> w</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="bu">sorted</span>([(dense.names[k], v) <span class="cf">for</span> k, v <span class="kw">in</span> <span class="bu">enumerate</span>(vec)],</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>       key<span class="op">=</span><span class="kw">lambda</span> x: np.fabs(x[<span class="dv">1</span>]), reverse<span class="op">=</span><span class="va">True</span>)[:<span class="dv">5</span>]</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>[('ocurrir', 0.06683457750173856),
 ('muere', 0.053880044741064774),
 ('consiguio', -0.05168798790090579),
 ('critican', -0.04459207389659752),
 ('hubieses', -0.04426955144485894)]</code></pre>
</div>
</div>
<p>La <a href="#fig-nube-ej-pos" class="quarto-xref">Figura&nbsp;<span>6.7</span></a> muestra la nube de palabras de los términos y características más significativas para la predicción del ejemplo positivo (<em>Asesinan a persona en Jalisco</em>). La nube de palabras para el ejemplo negativo (<em>La asesina vivía en Jalisco</em>) se muestra en la <a href="#fig-nube-ej" class="quarto-xref">Figura&nbsp;<span>6.8</span></a>. La nube de palabras está codificada de la siguiente manera, las palabras que corresponden a la clase positiva está en mayúsculas y las de la clase negativa en minúsculas. Por ejemplo, en <a href="#fig-nube-ej-pos" class="quarto-xref">Figura&nbsp;<span>6.7</span></a> se observa que la palabra <em>asesinan</em> es relevante para la clasificación del ejemplo así como la característica <strong>ocurrir</strong>.</p>
<div id="cell-fig-nube-ej-pos" class="cell" data-execution_count="33">
<details>
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> codifica(names, vec):</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    carac_pos <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k, v <span class="kw">in</span> <span class="bu">zip</span>(names, vec):</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> v <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>            key <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>k<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>            key <span class="op">=</span> k</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>        carac_pos[key] <span class="op">=</span> np.fabs(v)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> carac_pos</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>txt <span class="op">=</span> <span class="st">'Asesinan a persona en Jalisco.'</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> dense.transform([txt])[<span class="dv">0</span>] <span class="op">*</span> dense.estimator_instance.coef_[<span class="dv">0</span>]</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>word_cloud_dense <span class="op">=</span> WordCloud().generate_from_frequencies(codifica(dense.names, _))</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> bow.estimator_instance.coef_[<span class="dv">0</span>]</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>vec <span class="op">=</span> bow.bow[txt]</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>carac_pos <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k, v <span class="kw">in</span> vec:</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> w[k] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>        key <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>bow<span class="sc">.</span>names[k]<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>        key <span class="op">=</span> bow.names[k]</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>    carac_pos[key] <span class="op">=</span> np.fabs(v <span class="op">*</span> w[k])</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>word_cloud <span class="op">=</span> WordCloud().generate_from_frequencies(carac_pos)</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>ax1.imshow(word_cloud, interpolation<span class="op">=</span><span class="st">'bilinear'</span>)</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>ax2.imshow(word_cloud_dense, interpolation<span class="op">=</span><span class="st">'bilinear'</span>)</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax, title <span class="kw">in</span> <span class="bu">zip</span>([ax1, ax2], [<span class="st">'BoW'</span>, <span class="st">'DenseBoW'</span>]):</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>    ax.grid(<span class="va">False</span>)</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(left<span class="op">=</span><span class="va">False</span>, right<span class="op">=</span><span class="va">False</span>, labelleft<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>                   labelbottom<span class="op">=</span><span class="va">False</span>, bottom<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-nube-ej-pos" class="quarto-figure quarto-figure-center anchored" width="540" height="157">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nube-ej-pos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06MezclaModelos_files/figure-html/fig-nube-ej-pos-output-1.png" width="540" height="157" class="figure-img">
</div>
<figcaption class="figure quarto-float-caption quarto-float-fig" id="fig-nube-ej-pos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.7: Nube de características ejemplo positivo
</figcaption>
</figure>
</div>
</div>
</div>
<p>En el caso del ejemplo negativo, la <a href="#fig-nube-ej" class="quarto-xref">Figura&nbsp;<span>6.8</span></a> muestra q-gramas de caracteres asociados a la clase positiva y también es evidente la palabra <em>asesina</em>. En el caso del clasificador denso también se observan características positivas como <strong>ocurrir</strong> y características negativas como <strong>critican</strong> y <strong>empleados</strong>.</p>
<div id="cell-fig-nube-ej" class="cell" data-execution_count="34">
<details>
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>txt <span class="op">=</span> <span class="st">'La asesina vivía en Jalisco.'</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> dense.transform([txt])[<span class="dv">0</span>] <span class="op">*</span> dense.estimator_instance.coef_[<span class="dv">0</span>]</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>word_cloud_dense <span class="op">=</span> WordCloud().generate_from_frequencies(codifica(dense.names, _))</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> bow.estimator_instance.coef_[<span class="dv">0</span>]</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>vec <span class="op">=</span> bow.bow[txt]</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>carac_pos <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k, v <span class="kw">in</span> vec:</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> w[k] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>        key <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>bow<span class="sc">.</span>names[k]<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>        key <span class="op">=</span> bow.names[k]</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    carac_pos[key] <span class="op">=</span> np.fabs(v <span class="op">*</span> w[k])</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>word_cloud <span class="op">=</span> WordCloud().generate_from_frequencies(carac_pos)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>ax1.imshow(word_cloud, interpolation<span class="op">=</span><span class="st">'bilinear'</span>)</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>ax2.imshow(word_cloud_dense, interpolation<span class="op">=</span><span class="st">'bilinear'</span>)</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax, title <span class="kw">in</span> <span class="bu">zip</span>([ax1, ax2], [<span class="st">'BoW'</span>, <span class="st">'DenseBoW'</span>]):</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    ax.grid(<span class="va">False</span>)</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(left<span class="op">=</span><span class="va">False</span>, right<span class="op">=</span><span class="va">False</span>, labelleft<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>                   labelbottom<span class="op">=</span><span class="va">False</span>, bottom<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-nube-ej" class="quarto-figure quarto-figure-center anchored" width="540" height="157">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nube-ej-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06MezclaModelos_files/figure-html/fig-nube-ej-output-1.png" width="540" height="157" class="figure-img">
</div>
<figcaption class="figure quarto-float-caption quarto-float-fig" id="fig-nube-ej-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.8: Nube de características ejemplo negativo
</figcaption>
</figure>
</div>
</div>
</div>
<p>Complementando los ejemplos anteriores, la <a href="#fig-nube-ej-error" class="quarto-xref">Figura&nbsp;<span>6.9</span></a> muestra la nube de palabras obtenidas al calcular la función de decisión del texto <em>Le acaban de robar la bicicleta a mi hijo.</em> Se observa que este texto corresponde a la clase positiva y la función de decisión normalizada del clasificador disperso es <span class="math inline">\(-0.0335\)</span> y del clasificador denso corresponde a <span class="math inline">\(-0.0798\)</span>. Ambas funciones de decisión indican que la clase es negativa, lo cual es un error. La figura muestra que los q-gramas de caracteres y las características positivas dominan las nubes, pero estas no tienen el peso suficiente para realizar una predicción correcta.</p>
<div id="cell-fig-nube-ej-error" class="cell" data-execution_count="36">
<details>
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>txt <span class="op">=</span> <span class="st">'Le acaban de robar la bicicleta a mi hijo.'</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> dense.transform([txt])[<span class="dv">0</span>] <span class="op">*</span> dense.estimator_instance.coef_[<span class="dv">0</span>]</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>word_cloud_dense <span class="op">=</span> WordCloud().generate_from_frequencies(codifica(dense.names, _))</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> bow.estimator_instance.coef_[<span class="dv">0</span>]</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>vec <span class="op">=</span> bow.bow[txt]</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>carac_pos <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k, v <span class="kw">in</span> vec:</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> w[k] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>        key <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>bow<span class="sc">.</span>names[k]<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>        key <span class="op">=</span> bow.names[k]</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    carac_pos[key] <span class="op">=</span> np.fabs(v <span class="op">*</span> w[k])</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>word_cloud <span class="op">=</span> WordCloud().generate_from_frequencies(carac_pos)</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>ax1.imshow(word_cloud, interpolation<span class="op">=</span><span class="st">'bilinear'</span>)</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>ax2.imshow(word_cloud_dense, interpolation<span class="op">=</span><span class="st">'bilinear'</span>)</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax, title <span class="kw">in</span> <span class="bu">zip</span>([ax1, ax2], [<span class="st">'BoW'</span>, <span class="st">'DenseBoW'</span>]):</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>    ax.grid(<span class="va">False</span>)</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(left<span class="op">=</span><span class="va">False</span>, right<span class="op">=</span><span class="va">False</span>, labelleft<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>                   labelbottom<span class="op">=</span><span class="va">False</span>, bottom<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-nube-ej-error" class="quarto-figure quarto-figure-center anchored" width="540" height="157">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nube-ej-error-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06MezclaModelos_files/figure-html/fig-nube-ej-error-output-1.png" width="540" height="157" class="figure-img">
</div>
<figcaption class="figure quarto-float-caption quarto-float-fig" id="fig-nube-ej-error-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.9: Nube de características en un ejemplo positivo con predicción negativa
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="combinando-modelos" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="combinando-modelos"><span class="header-section-number">6.5</span> Combinando Modelos</h2>
<div class="cell">
<div class="cell-output-display">
<div id="fig-prediccion-1-estimador" class="quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-prediccion-1-estimador-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-prediccion-1-estimador">flowchart TB
    Conc[Concatenación]
    Representación --&gt; Estimadores --&gt; Conc
    Conc --&gt; Predicción
    subgraph Representación [Representaciones]
        direction TB
        Repr1([Representación 1])
        Repr2([Representación 2])
        ReprI([...])
        ReprM([Representación M])
    end
    subgraph Estimadores
        direction TB    
        Est1[Estimador 1] 
        Est2[Estimador 2]
        EstI[...]
        EstM[Estimador M]
    end
    subgraph Predicción [Etapa de Predicción]
        direction TB
        Entrada
        Entrada -- Clasificación --&gt; Clasificador[Clasificador]
        Entrada -- Regresión --&gt; Regresor[Regresor]
        Clasificador --&gt; Prediccion([Predicción])
        Regresor --&gt; Prediccion
    end
</pre>
</div>
</div>
<figcaption class="figure quarto-float-caption quarto-float-fig" id="fig-prediccion-1-estimador-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6.10: Diagrama de predicción en mezcla de modelos
</figcaption>
</figure>
</div>
</div>
</div>
<p>La siguiente pregunta es conocer si los modelos anteriores se pueden combinar para realizar una mejor predicción. En esta sección se utiliza la técnica de Stack Generalization (<span class="citation" data-cites="Wolpert1992StackedGeneralization">Wolpert (<a href="11Referencias.html#ref-Wolpert1992StackedGeneralization" role="doc-biblioref">1992</a>)</span>, <span class="citation" data-cites="EvoMSA">Graff et&nbsp;al. (<a href="11Referencias.html#ref-EvoMSA" role="doc-biblioref">2020</a>)</span>) para combinar los dos modelos. La siguiente linea entrena el clasificador, el cual recibe como parámetros los clasificador a juntar.</p>
<div id="65631192" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>stack <span class="op">=</span> StackGeneralization([bow, dense]).fit(D)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Siguiendo el procedimiento de los clasificadores dispersos y densos, la siguiente linea predice la clase de los ejemplos del conjunto de prueba y calcula su rendimiento en términos de la medida <span class="math inline">\(f_1\)</span>.</p>
<div id="ad79032d" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>hy_stack <span class="op">=</span> stack.predict(Dtest)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>f1_score(y, hy_stack, average<span class="op">=</span><span class="va">None</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>array([0.94791667, 0.79166667])</code></pre>
</div>
</div>
<p>Para poder comparar el rendimiento de los tres clasificadores desarrollados, la <a href="#tbl-performance-recall-precision-delitos" class="quarto-xref">Tabla&nbsp;<span>6.1</span></a> presenta el rendimiento con las medidas recall y precision en las dos clases. Se puede observar que el <code>bow</code> tiene el mejor recall en la clase negativa y mejor precision en la clase positiva. Por otro lado el mejor recall en la clase positiva y precision en la clase negativa lo tiene <code>stack</code>.</p>
<div id="tbl-performance-recall-precision-delitos" class="cell anchored" data-execution_count="39">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="table quarto-float-caption quarto-float-tbl" id="tbl-performance-recall-precision-delitos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;6.1: Rendimiento
</figcaption>
<div aria-describedby="tbl-performance-recall-precision-delitos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="39">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 17%">
<col style="width: 21%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Recall neg</th>
<th>&nbsp;Recall pos</th>
<th>Precision neg</th>
<th>&nbsp;Precision pos</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>bow</code></td>
<td><span class="math inline">\(0.9894\)</span></td>
<td><span class="math inline">\(0.6184\)</span></td>
<td><span class="math inline">\(0.9065\)</span></td>
<td><span class="math inline">\(0.9400\)</span></td>
</tr>
<tr class="even">
<td><code>dense</code></td>
<td><span class="math inline">\(0.9648\)</span></td>
<td><span class="math inline">\(0.6842\)</span></td>
<td><span class="math inline">\(0.9195\)</span></td>
<td><span class="math inline">\(0.8387\)</span></td>
</tr>
<tr class="odd">
<td><code>stack</code></td>
<td><span class="math inline">\(0.9613\)</span></td>
<td><span class="math inline">\(0.7500\)</span></td>
<td><span class="math inline">\(0.9349\)</span></td>
<td><span class="math inline">\(0.8382\)</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
<p>Con respecto al rendimiento en términos de <span class="math inline">\(f_1\)</span>, la <a href="#tbl-performance-f1-delitos" class="quarto-xref">Tabla&nbsp;<span>6.2</span></a> presenta la información con respecto a cada clase y la última columna contiene el macro-<span class="math inline">\(f_1\)</span>. Los valores indican que en la clase positiva el mejor valor corresponde a <code>stack</code> lo cual se ve reflejado en el macro-<span class="math inline">\(f_1\)</span>. El algoritmo de Stack Generalization nos indica que se hizo una mejora en la predicción de la clase positiva y la clase negativa se mantuvo constante al menos con respecto de la medida <span class="math inline">\(f_1\)</span>.</p>
<div id="tbl-performance-f1-delitos" class="cell anchored" data-execution_count="40">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="table quarto-float-caption quarto-float-tbl" id="tbl-performance-f1-delitos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;6.2: Rendimiento
</figcaption>
<div aria-describedby="tbl-performance-f1-delitos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="40">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th></th>
<th>f1 neg</th>
<th>&nbsp;f1 pos</th>
<th>macro-f1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>bow</code></td>
<td><span class="math inline">\(0.9461\)</span></td>
<td><span class="math inline">\(0.7460\)</span></td>
<td><span class="math inline">\(0.8461\)</span></td>
</tr>
<tr class="even">
<td><code>dense</code></td>
<td><span class="math inline">\(0.9416\)</span></td>
<td><span class="math inline">\(0.7536\)</span></td>
<td><span class="math inline">\(0.8476\)</span></td>
</tr>
<tr class="odd">
<td><code>stack</code></td>
<td><span class="math inline">\(0.9479\)</span></td>
<td><span class="math inline">\(0.7917\)</span></td>
<td><span class="math inline">\(0.8698\)</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-EvoMSA" class="csl-entry" role="listitem">
Graff, Mario, Sabino Miranda-Jiménez, Eric S. Tellez, y Daniela Moctezuma. 2020. <span>«EvoMSA: <span>A</span> Multilingual Evolutionary Approach for Sentiment Analysis»</span>. <em>Computational Intelligence Magazine</em> 15: 76-88. <a href="https://ieeexplore.ieee.org/document/8956106">https://ieeexplore.ieee.org/document/8956106</a>.
</div>
<div id="ref-Wolpert1992StackedGeneralization" class="csl-entry" role="listitem">
Wolpert, David H. 1992. <span>«<span>Stacked generalization</span>»</span>. <em>Neural Networks</em> 5 (2): 241-59. <a href="https://doi.org/10.1016/S0893-6080(05)80023-1">https://doi.org/10.1016/S0893-6080(05)80023-1</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        console.log("RESIZE");
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../capitulos/05RepresentacionTexto.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Representación de Texto</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../capitulos/07TareasClasificacion.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Tareas de Clasificación de Texto</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Ejecutar el código</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb45" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Mezcla de Modelos</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>El **objetivo** de la unidad es </span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="fu">## Paquetes usados {.unnumbered}</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> EvoMSA <span class="im">import</span> BoW,<span class="op">\</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>                   DenseBoW,<span class="op">\</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>                   StackGeneralization</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> microtc.utils <span class="im">import</span> tweet_iterator</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IngeoML <span class="im">import</span> CI, SelectFromModelCV</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> f1_score,<span class="op">\</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>                            recall_score,<span class="op">\</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>                            precision_score</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> wordcloud <span class="im">import</span> WordCloud                            </span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pylab <span class="im">as</span> plt</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Markdown</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> os.path <span class="im">import</span> isfile, isdir</span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> EvoMSA.utils <span class="im">import</span> Download</span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> EvoMSA <span class="im">import</span> utils</span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a>utils.USE_TQDM <span class="op">=</span> <span class="va">False</span></span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> isfile(<span class="st">'delitos.zip'</span>):</span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a>    Download(<span class="st">'https://github.com/INGEOTEC/Delitos/releases/download/Datos/delitos.zip'</span>,</span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true" tabindex="-1"></a>             <span class="st">'delitos.zip'</span>)</span>
<span id="cb45-45"><a href="#cb45-45" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> isdir(<span class="st">'delitos'</span>):</span>
<span id="cb45-46"><a href="#cb45-46" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>unzip <span class="op">-</span>Pingeotec delitos.<span class="bu">zip</span></span>
<span id="cb45-47"><a href="#cb45-47" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-48"><a href="#cb45-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-49"><a href="#cb45-49" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb45-50"><a href="#cb45-50" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb45-51"><a href="#cb45-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-52"><a href="#cb45-52" aria-hidden="true" tabindex="-1"></a>**Video explicando la unidad**</span>
<span id="cb45-53"><a href="#cb45-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-54"><a href="#cb45-54" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb45-55"><a href="#cb45-55" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb45-56"><a href="#cb45-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-57"><a href="#cb45-57" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introducción </span></span>
<span id="cb45-58"><a href="#cb45-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-59"><a href="#cb45-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-62"><a href="#cb45-62" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb45-63"><a href="#cb45-63" aria-hidden="true" tabindex="-1"></a><span class="in">%%| echo: false</span></span>
<span id="cb45-64"><a href="#cb45-64" aria-hidden="true" tabindex="-1"></a><span class="in">%%| fig-cap: Diagrama de predicción </span></span>
<span id="cb45-65"><a href="#cb45-65" aria-hidden="true" tabindex="-1"></a><span class="in">%%| label: fig-prediccion-1-estimador</span></span>
<span id="cb45-66"><a href="#cb45-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-67"><a href="#cb45-67" aria-hidden="true" tabindex="-1"></a><span class="in">flowchart LR</span></span>
<span id="cb45-68"><a href="#cb45-68" aria-hidden="true" tabindex="-1"></a><span class="in">    Repr([Representación]) -- Clasificación --&gt; Clasificador[Clasificador]</span></span>
<span id="cb45-69"><a href="#cb45-69" aria-hidden="true" tabindex="-1"></a><span class="in">    Repr -- Regresión --&gt; Regresor[Regresor]</span></span>
<span id="cb45-70"><a href="#cb45-70" aria-hidden="true" tabindex="-1"></a><span class="in">    Clasificador --&gt; Prediccion([Predicción])</span></span>
<span id="cb45-71"><a href="#cb45-71" aria-hidden="true" tabindex="-1"></a><span class="in">    Regresor --&gt; Prediccion</span></span>
<span id="cb45-72"><a href="#cb45-72" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-73"><a href="#cb45-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-74"><a href="#cb45-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-75"><a href="#cb45-75" aria-hidden="true" tabindex="-1"></a>El conjunto de datos se puede conseguir en la página de <span class="co">[</span><span class="ot">Delitos</span><span class="co">](https://ingeotec.github.io/Delitos)</span> aunque en esta dirección es necesario poblar los textos dado que solamente se encuentra el identificador del Tweet.</span>
<span id="cb45-76"><a href="#cb45-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-77"><a href="#cb45-77" aria-hidden="true" tabindex="-1"></a>Para leer los datos del conjunto de entrenamiento y prueba se utilizan las siguientes instrucciones. En la variable <span class="in">`D`</span> se tiene los datos que se utilizarán para entrenar el clasificador basado en la bolsa de palabras y en <span class="in">`Dtest`</span> los datos del conjunto de prueba, que son usados para medir el rendimiento del clasificador.</span>
<span id="cb45-78"><a href="#cb45-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-81"><a href="#cb45-81" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-82"><a href="#cb45-82" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb45-83"><a href="#cb45-83" aria-hidden="true" tabindex="-1"></a>fname <span class="op">=</span> <span class="st">'delitos/delitos_ingeotec_Es_train.json'</span></span>
<span id="cb45-84"><a href="#cb45-84" aria-hidden="true" tabindex="-1"></a>fname_test <span class="op">=</span> <span class="st">'delitos/delitos_ingeotec_Es_test.json'</span></span>
<span id="cb45-85"><a href="#cb45-85" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> <span class="bu">list</span>(tweet_iterator(fname))</span>
<span id="cb45-86"><a href="#cb45-86" aria-hidden="true" tabindex="-1"></a>Dtest <span class="op">=</span> <span class="bu">list</span>(tweet_iterator(fname_test))</span>
<span id="cb45-87"><a href="#cb45-87" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-88"><a href="#cb45-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-89"><a href="#cb45-89" aria-hidden="true" tabindex="-1"></a>En la siguiente instrucción se observa el primer elemento del conjunto de entrenamiento. Se puede observar que en el campo <span class="in">`text`</span> se encuentra el texto, el campo <span class="in">`klass`</span> representa la etiqueta o clase, donde $0$ representa la clase negativa y $1$ la clase positiva, es decir, la presencia de un delito. El campo <span class="in">`id`</span> es el identificador del Tweet y <span class="in">`annotations`</span> son las clases dadas por los etiquetadores a ese ejemplo.</span>
<span id="cb45-90"><a href="#cb45-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-93"><a href="#cb45-93" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-94"><a href="#cb45-94" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb45-95"><a href="#cb45-95" aria-hidden="true" tabindex="-1"></a>D[<span class="dv">81</span>]</span>
<span id="cb45-96"><a href="#cb45-96" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-97"><a href="#cb45-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-98"><a href="#cb45-98" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bolsa de Palabras Dispersa </span></span>
<span id="cb45-99"><a href="#cb45-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-100"><a href="#cb45-100" aria-hidden="true" tabindex="-1"></a>Se inicia con la creación de un clasificador basado en una bolsa de palabras dispersa, el clasificador es una máquina de soporte vectorial lineal (<span class="in">`LinearSVC`</span>). La siguiente instrucción usa la clase <span class="in">`BoW`</span> para crear este clasificador de texto. El primer paso es seleccionar el lenguaje, en este caso español (es) y después se entrena usando el método <span class="in">`fit`</span>.</span>
<span id="cb45-101"><a href="#cb45-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-104"><a href="#cb45-104" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-105"><a href="#cb45-105" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb45-106"><a href="#cb45-106" aria-hidden="true" tabindex="-1"></a>bow <span class="op">=</span> BoW(lang<span class="op">=</span><span class="st">'es'</span>).fit(D)</span>
<span id="cb45-107"><a href="#cb45-107" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-108"><a href="#cb45-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-109"><a href="#cb45-109" aria-hidden="true" tabindex="-1"></a>Habiendo entrenado el clasificador de texto es momento de utilizarlo para predecir, las siguientes dos instrucciones muestra el uso de la instancia <span class="in">`bow`</span> para predecir clase del texto *me golpearon y robaron la bicicleta en la noche.* Se puede observar que la clase es $1$, lo cual indica que el texto menciona la ejecución de un delito.</span>
<span id="cb45-110"><a href="#cb45-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-113"><a href="#cb45-113" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-114"><a href="#cb45-114" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb45-115"><a href="#cb45-115" aria-hidden="true" tabindex="-1"></a>txt <span class="op">=</span> <span class="st">'me golpearon y robaron la bicicleta en la noche'</span></span>
<span id="cb45-116"><a href="#cb45-116" aria-hidden="true" tabindex="-1"></a>bow.predict([txt])</span>
<span id="cb45-117"><a href="#cb45-117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-118"><a href="#cb45-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-119"><a href="#cb45-119" aria-hidden="true" tabindex="-1"></a>El método <span class="in">`predict`</span> recibe una lista de textos a predecir, en la siguiente instrucción se predicen todas las clases del conjunto de prueba (<span class="in">`Dtest`</span>), la predicciones se guardar en la variable <span class="in">`hy_bow`</span>.</span>
<span id="cb45-120"><a href="#cb45-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-123"><a href="#cb45-123" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-124"><a href="#cb45-124" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb45-125"><a href="#cb45-125" aria-hidden="true" tabindex="-1"></a>hy_bow <span class="op">=</span> bow.predict(Dtest)</span>
<span id="cb45-126"><a href="#cb45-126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-127"><a href="#cb45-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-130"><a href="#cb45-130" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-131"><a href="#cb45-131" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb45-132"><a href="#cb45-132" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.r_[[x[<span class="st">'klass'</span>] <span class="cf">for</span> x <span class="kw">in</span> Dtest]]</span>
<span id="cb45-133"><a href="#cb45-133" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> f1_score(y, hy_bow, average<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb45-134"><a href="#cb45-134" aria-hidden="true" tabindex="-1"></a>f1_0 <span class="op">=</span> Markdown(<span class="ss">f'$</span><span class="sc">{</span>a[<span class="dv">0</span>]<span class="sc">:0.4f}</span><span class="ss">$'</span>)</span>
<span id="cb45-135"><a href="#cb45-135" aria-hidden="true" tabindex="-1"></a>f1_1 <span class="op">=</span> Markdown(<span class="ss">f'$</span><span class="sc">{</span>a[<span class="dv">1</span>]<span class="sc">:0.4f}</span><span class="ss">$'</span>)</span>
<span id="cb45-136"><a href="#cb45-136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-137"><a href="#cb45-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-138"><a href="#cb45-138" aria-hidden="true" tabindex="-1"></a>Habiendo realizado la predicciones en el conjunto de prueba ($\mathcal D$), es momento de utilizar estas para medir el rendimiento, en esta ocasión se mide el valor $f_1$ para cada clase. El primer valor (<span class="in">`{python} f1_0`</span>) corresponde a la medida $f_1$ en la clase negativa y el segundo (<span class="in">`{python} f1_1`</span>) corresponde al valor en la clase positiva.</span>
<span id="cb45-139"><a href="#cb45-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-142"><a href="#cb45-142" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-143"><a href="#cb45-143" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb45-144"><a href="#cb45-144" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.r_[[x[<span class="st">'klass'</span>] <span class="cf">for</span> x <span class="kw">in</span> Dtest]]</span>
<span id="cb45-145"><a href="#cb45-145" aria-hidden="true" tabindex="-1"></a>f1_score(y, hy_bow, average<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb45-146"><a href="#cb45-146" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-147"><a href="#cb45-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-148"><a href="#cb45-148" aria-hidden="true" tabindex="-1"></a>Con el objetivo de conocer la variabilidad del rendimiento del clasificador en este conjunto de datos, la siguientes instrucciones calcula el intervalo de confianza; para realizarlo se utiliza la clase <span class="in">`CI`</span> la cual recibe la estadística a calcular, en este caso medida $f_1$. El siguiente paso es llamar a la clase con las entradas para calcular el intervalo, estas corresponden a las mediciones y predicciones del conjunto de prueba. </span>
<span id="cb45-149"><a href="#cb45-149" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb45-152"><a href="#cb45-152" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-153"><a href="#cb45-153" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb45-154"><a href="#cb45-154" aria-hidden="true" tabindex="-1"></a>ci <span class="op">=</span> CI(statistic<span class="op">=</span><span class="kw">lambda</span> y, hy: f1_score(y, hy, </span>
<span id="cb45-155"><a href="#cb45-155" aria-hidden="true" tabindex="-1"></a>                                         average<span class="op">=</span><span class="va">None</span>))</span>
<span id="cb45-156"><a href="#cb45-156" aria-hidden="true" tabindex="-1"></a>ci_izq, ci_der <span class="op">=</span> ci(y, hy_bow)</span>
<span id="cb45-157"><a href="#cb45-157" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-158"><a href="#cb45-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-161"><a href="#cb45-161" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-162"><a href="#cb45-162" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb45-163"><a href="#cb45-163" aria-hidden="true" tabindex="-1"></a>ci_izq_f <span class="op">=</span> <span class="st">', '</span>.join([<span class="ss">f'</span><span class="sc">{</span>v<span class="sc">:0.4f}</span><span class="ss">'</span> <span class="cf">for</span> v <span class="kw">in</span> ci_izq])</span>
<span id="cb45-164"><a href="#cb45-164" aria-hidden="true" tabindex="-1"></a>ci_izq_f <span class="op">=</span> Markdown(<span class="ss">f'$[</span><span class="sc">{</span>ci_izq_f<span class="sc">}</span><span class="ss">]$'</span>)</span>
<span id="cb45-165"><a href="#cb45-165" aria-hidden="true" tabindex="-1"></a>ci_der_f <span class="op">=</span> <span class="st">', '</span>.join([<span class="ss">f'</span><span class="sc">{</span>v<span class="sc">:0.4f}</span><span class="ss">'</span> <span class="cf">for</span> v <span class="kw">in</span> ci_der])</span>
<span id="cb45-166"><a href="#cb45-166" aria-hidden="true" tabindex="-1"></a>ci_der_f <span class="op">=</span> Markdown(<span class="ss">f'$[</span><span class="sc">{</span>ci_der_f<span class="sc">}</span><span class="ss">]$'</span>)</span>
<span id="cb45-167"><a href="#cb45-167" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-168"><a href="#cb45-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-169"><a href="#cb45-169" aria-hidden="true" tabindex="-1"></a>El intervalo izquierdo es <span class="in">`{python} ci_izq_f`</span> y el derecho tiene los valores <span class="in">`{python} ci_der_f`</span>. Para complementar la información del intervalo de confianza, la @fig-hist-f1-bow muestra el histograma y la densidad estimada para calcular el intervalo de confianza. Se ve que la varianza en la clase negativa es menor además de que tiene un rendimiento mejor que en la clase positiva. </span>
<span id="cb45-170"><a href="#cb45-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-173"><a href="#cb45-173" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-174"><a href="#cb45-174" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb45-175"><a href="#cb45-175" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Histograma de f1 por clase</span></span>
<span id="cb45-176"><a href="#cb45-176" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-hist-f1-bow</span></span>
<span id="cb45-177"><a href="#cb45-177" aria-hidden="true" tabindex="-1"></a>df_bow <span class="op">=</span> pd.DataFrame(ci.statistic_samples, columns<span class="op">=</span>[<span class="st">'f1-neg'</span>, <span class="st">'f1-pos'</span>])</span>
<span id="cb45-178"><a href="#cb45-178" aria-hidden="true" tabindex="-1"></a>df_bow[<span class="st">'Tipo'</span>] <span class="op">=</span> <span class="st">'BoW'</span></span>
<span id="cb45-179"><a href="#cb45-179" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">'whitegrid'</span>)</span>
<span id="cb45-180"><a href="#cb45-180" aria-hidden="true" tabindex="-1"></a>sns.displot(df_bow, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb45-181"><a href="#cb45-181" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-182"><a href="#cb45-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-183"><a href="#cb45-183" aria-hidden="true" tabindex="-1"></a>Una manera de poder analizar el comportamiento del clasificador de texto implementado es visualizar en una nube de palabras las características que tienen el mayor peso en la decisión. Esto se realiza en las siguientes instrucciones siendo el primer paso obtener los coeficientes de la máquina de soporte vectorial lineal, los cuales se guardan en la variable <span class="in">`ws`</span>. El segundo componente es el valor de IDF que tiene cada uno de los términos, esto se encuentran en el atributo <span class="in">`BoW.weights`</span> tal y como se muestra en la segunda instrucción del siguiente código. </span>
<span id="cb45-184"><a href="#cb45-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-187"><a href="#cb45-187" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-188"><a href="#cb45-188" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb45-189"><a href="#cb45-189" aria-hidden="true" tabindex="-1"></a>ws <span class="op">=</span> bow.estimator_instance.coef_[<span class="dv">0</span>]</span>
<span id="cb45-190"><a href="#cb45-190" aria-hidden="true" tabindex="-1"></a>idfs <span class="op">=</span> bow.weights</span>
<span id="cb45-191"><a href="#cb45-191" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-192"><a href="#cb45-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-193"><a href="#cb45-193" aria-hidden="true" tabindex="-1"></a>Teniendo los valores del clasificador y del IDF, solamente es necesario obtener su producto y separar los términos positivos de los negativos, tal y como se muestra en el siguiente código. La @fig-nube-tokens muestra las nubes de palabras generadas, cabe mencionar que aquellos términos que tienen como prefijo <span class="in">`q:`</span> corresponden a q-gramas de caracteres y los términos que tienen el caracter <span class="in">`~`</span> corresponden a bigramas de palabras. </span>
<span id="cb45-194"><a href="#cb45-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-197"><a href="#cb45-197" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-198"><a href="#cb45-198" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb45-199"><a href="#cb45-199" aria-hidden="true" tabindex="-1"></a>tokens_pos <span class="op">=</span> {name: w <span class="op">*</span> idf</span>
<span id="cb45-200"><a href="#cb45-200" aria-hidden="true" tabindex="-1"></a>              <span class="cf">for</span> name, idf, w <span class="kw">in</span> <span class="bu">zip</span>(bow.names,</span>
<span id="cb45-201"><a href="#cb45-201" aria-hidden="true" tabindex="-1"></a>                                      idfs, ws)</span>
<span id="cb45-202"><a href="#cb45-202" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> w <span class="op">&gt;</span> <span class="dv">0</span>}</span>
<span id="cb45-203"><a href="#cb45-203" aria-hidden="true" tabindex="-1"></a>tokens_neg <span class="op">=</span> {name: w <span class="op">*</span> idf <span class="op">*</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb45-204"><a href="#cb45-204" aria-hidden="true" tabindex="-1"></a>              <span class="cf">for</span> name, idf, w <span class="kw">in</span> <span class="bu">zip</span>(bow.names,</span>
<span id="cb45-205"><a href="#cb45-205" aria-hidden="true" tabindex="-1"></a>                                      idfs, ws)</span>
<span id="cb45-206"><a href="#cb45-206" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> w <span class="op">&lt;</span> <span class="dv">0</span>}</span>
<span id="cb45-207"><a href="#cb45-207" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-208"><a href="#cb45-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-209"><a href="#cb45-209" aria-hidden="true" tabindex="-1"></a>En la figura se puede observar que las características más importantes corresponden a la presencia de *asesinan*, *asesinan a*, *tiroteo* entre otras y por el lado de palabras relacionadas a la clase negativa se observan *secuestrado*, *asesina*, *un asesino*, entre otras. En @sec-analisis-ejemplo se muestran ejemplos que ayudan a comprender el hecho de que la palabra *asesinan* sea considerada como positiva y por otro lado *asesina* se en la clase negativa.</span>
<span id="cb45-210"><a href="#cb45-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-213"><a href="#cb45-213" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-214"><a href="#cb45-214" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb45-215"><a href="#cb45-215" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Nubes de términos positivos y negativos</span></span>
<span id="cb45-216"><a href="#cb45-216" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-nube-tokens</span></span>
<span id="cb45-217"><a href="#cb45-217" aria-hidden="true" tabindex="-1"></a>word_pos <span class="op">=</span> WordCloud().generate_from_frequencies(tokens_pos)</span>
<span id="cb45-218"><a href="#cb45-218" aria-hidden="true" tabindex="-1"></a>word_neg <span class="op">=</span> WordCloud().generate_from_frequencies(tokens_neg)</span>
<span id="cb45-219"><a href="#cb45-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-220"><a href="#cb45-220" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb45-221"><a href="#cb45-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-222"><a href="#cb45-222" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cloud, ax, title <span class="kw">in</span> <span class="bu">zip</span>([word_neg, word_pos],</span>
<span id="cb45-223"><a href="#cb45-223" aria-hidden="true" tabindex="-1"></a>                     [ax1, ax2],</span>
<span id="cb45-224"><a href="#cb45-224" aria-hidden="true" tabindex="-1"></a>                     [<span class="st">'Negativas'</span>, <span class="st">'Positivas'</span>]):</span>
<span id="cb45-225"><a href="#cb45-225" aria-hidden="true" tabindex="-1"></a>    ax.imshow(cloud, interpolation<span class="op">=</span><span class="st">'bilinear'</span>)</span>
<span id="cb45-226"><a href="#cb45-226" aria-hidden="true" tabindex="-1"></a>    ax.grid(<span class="va">False</span>)</span>
<span id="cb45-227"><a href="#cb45-227" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(left<span class="op">=</span><span class="va">False</span>, right<span class="op">=</span><span class="va">False</span>, labelleft<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb45-228"><a href="#cb45-228" aria-hidden="true" tabindex="-1"></a>                   labelbottom<span class="op">=</span><span class="va">False</span>, bottom<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb45-229"><a href="#cb45-229" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title)</span>
<span id="cb45-230"><a href="#cb45-230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-231"><a href="#cb45-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-232"><a href="#cb45-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-233"><a href="#cb45-233" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bolsa de Palabras Densas </span></span>
<span id="cb45-234"><a href="#cb45-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-235"><a href="#cb45-235" aria-hidden="true" tabindex="-1"></a>Es ahora el turno de hacer el análisis del clasificador de texto que se basado en bolsa de palabras densas. La siguiente instrucción muestra el uso de este clasificador donde se usa una bolsa de palabras con un vocabulario de $2^{15}$ (parámetro <span class="in">`voc_size_exponent=15`</span>) y además se seleccionan como representaciones aquellos entrenados en los conjuntos de emojis (<span class="in">`emoji=True`</span>) y las palabras claves (<span class="in">`keyword=True`</span>). En esta caso, los parámetros del clasificador no son estimados, es decir, no se llama al método <span class="in">`fit`</span>. Esto es porque en este ejemplo se van a seleccionar aquellas representaciones que mejor representan al problema de Delitos utilizando una máquina de soporte vectorial lineal. </span>
<span id="cb45-236"><a href="#cb45-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-239"><a href="#cb45-239" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-240"><a href="#cb45-240" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb45-241"><a href="#cb45-241" aria-hidden="true" tabindex="-1"></a>dense <span class="op">=</span> DenseBoW(lang<span class="op">=</span><span class="st">'es'</span>,</span>
<span id="cb45-242"><a href="#cb45-242" aria-hidden="true" tabindex="-1"></a>                 voc_size_exponent<span class="op">=</span><span class="dv">15</span>,</span>
<span id="cb45-243"><a href="#cb45-243" aria-hidden="true" tabindex="-1"></a>                 emoji<span class="op">=</span><span class="va">True</span>, keyword<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb45-244"><a href="#cb45-244" aria-hidden="true" tabindex="-1"></a>                 dataset<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb45-245"><a href="#cb45-245" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-246"><a href="#cb45-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-247"><a href="#cb45-247" aria-hidden="true" tabindex="-1"></a>Para seleccionar las características que mejor representan al problema de delitos se utiliza la clase <span class="in">`SelectFromModelCV`</span> la cual usa los coeficientes de la máquina de soporte vectorial para seleccionar las características más representativas, estas corresponden aquellas que tienen los coeficientes más grandes tomando su valor absoluto. La selección se realiza llamando al método <span class="in">`DenseBoW.select`</span> con los parámetros que se observan en las siguientes instrucciones. En particular <span class="in">`SelectFromModelCV`</span> es un método supervisado entonces se utilizarán las clase del conjunto de entrenamiento, y para poder medir el rendimiento de cada conjunto de características seleccionadas se usa una validación cruzada. La última instrucción estima los valores del clasificador con las características seleccionadas. </span>
<span id="cb45-248"><a href="#cb45-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-251"><a href="#cb45-251" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-252"><a href="#cb45-252" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb45-253"><a href="#cb45-253" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb45-254"><a href="#cb45-254" aria-hidden="true" tabindex="-1"></a>macro_f1 <span class="op">=</span> <span class="kw">lambda</span> y, hy: f1_score(y, hy, average<span class="op">=</span><span class="st">'macro'</span>)</span>
<span id="cb45-255"><a href="#cb45-255" aria-hidden="true" tabindex="-1"></a>kwargs <span class="op">=</span> dense.estimator_kwargs</span>
<span id="cb45-256"><a href="#cb45-256" aria-hidden="true" tabindex="-1"></a>estimator <span class="op">=</span> dense.estimator_class(<span class="op">**</span>kwargs)</span>
<span id="cb45-257"><a href="#cb45-257" aria-hidden="true" tabindex="-1"></a>kwargs <span class="op">=</span> <span class="bu">dict</span>(estimator<span class="op">=</span>estimator,</span>
<span id="cb45-258"><a href="#cb45-258" aria-hidden="true" tabindex="-1"></a>              scoring<span class="op">=</span>macro_f1)</span>
<span id="cb45-259"><a href="#cb45-259" aria-hidden="true" tabindex="-1"></a>dense.select(D<span class="op">=</span>D,</span>
<span id="cb45-260"><a href="#cb45-260" aria-hidden="true" tabindex="-1"></a>             feature_selection<span class="op">=</span>SelectFromModelCV,</span>
<span id="cb45-261"><a href="#cb45-261" aria-hidden="true" tabindex="-1"></a>             feature_selection_kwargs<span class="op">=</span>kwargs)</span>
<span id="cb45-262"><a href="#cb45-262" aria-hidden="true" tabindex="-1"></a>dense.fit(D)</span>
<span id="cb45-263"><a href="#cb45-263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-264"><a href="#cb45-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-265"><a href="#cb45-265" aria-hidden="true" tabindex="-1"></a>Como se mencionó la clase <span class="in">`SelectFromModelCV`</span> selecciona aquellas características que mejor rendimiento dan, la clase mantiene los valores estimados en cada selección, las siguientes instrucciones ejemplifican como obtener los valores de rendimiento en las selecciones. La variable <span class="in">`perf`</span> es una diccionario donde la llave es el número de características y el valor es el rendimiento correspondiente. La @fig-dense-k muestra es rendimiento se puede observar la dinámica donde con un poco menos de $1000$ características se tiene un valor de rendimiento cercano a $0.9$.</span>
<span id="cb45-266"><a href="#cb45-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-269"><a href="#cb45-269" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-270"><a href="#cb45-270" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb45-271"><a href="#cb45-271" aria-hidden="true" tabindex="-1"></a>select <span class="op">=</span> dense.feature_selection</span>
<span id="cb45-272"><a href="#cb45-272" aria-hidden="true" tabindex="-1"></a>perf <span class="op">=</span> select.cv_results_</span>
<span id="cb45-273"><a href="#cb45-273" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-274"><a href="#cb45-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-277"><a href="#cb45-277" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-278"><a href="#cb45-278" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb45-279"><a href="#cb45-279" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Rendimiento Variando el Número de Características</span></span>
<span id="cb45-280"><a href="#cb45-280" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-dense-k</span></span>
<span id="cb45-281"><a href="#cb45-281" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> [{<span class="st">'d'</span>: k, <span class="st">'macro-f1'</span>: v} <span class="cf">for</span> k, v <span class="kw">in</span> perf.items()]</span>
<span id="cb45-282"><a href="#cb45-282" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(_)</span>
<span id="cb45-283"><a href="#cb45-283" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.lineplot(df, x<span class="op">=</span><span class="st">'d'</span>, y<span class="op">=</span><span class="st">'macro-f1'</span>)</span>
<span id="cb45-284"><a href="#cb45-284" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">'whitegrid'</span>)</span>
<span id="cb45-285"><a href="#cb45-285" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-286"><a href="#cb45-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-287"><a href="#cb45-287" aria-hidden="true" tabindex="-1"></a>Después de haber seleccionado el número de características, se utiliza un código equivalente al usado en <span class="in">`BoW`</span> para predecir las clases del conjunto de prueba ($\mathcal G$), tal y como se muestra en la siguiente instrucción. </span>
<span id="cb45-288"><a href="#cb45-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-291"><a href="#cb45-291" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-292"><a href="#cb45-292" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb45-293"><a href="#cb45-293" aria-hidden="true" tabindex="-1"></a>hy_dense <span class="op">=</span> dense.predict(Dtest)</span>
<span id="cb45-294"><a href="#cb45-294" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-295"><a href="#cb45-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-296"><a href="#cb45-296" aria-hidden="true" tabindex="-1"></a>El rendimiento en $f_1$ del clasificador basado en una bolsa se muestra con el siguiente código. Este valor puntual se complementa con la @fig-hist-f1-bow-dense donde se muestra la distribución de esta medición y se compara con la obtenida con el clasificador de bolsa de palabras dispersa (i.e., <span class="in">`bow`</span>).</span>
<span id="cb45-297"><a href="#cb45-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-300"><a href="#cb45-300" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-301"><a href="#cb45-301" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb45-302"><a href="#cb45-302" aria-hidden="true" tabindex="-1"></a>f1_score(y, hy_dense, average<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb45-303"><a href="#cb45-303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-304"><a href="#cb45-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-307"><a href="#cb45-307" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-308"><a href="#cb45-308" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb45-309"><a href="#cb45-309" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Histogramas de f1 por clase</span></span>
<span id="cb45-310"><a href="#cb45-310" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-hist-f1-bow-dense</span></span>
<span id="cb45-311"><a href="#cb45-311" aria-hidden="true" tabindex="-1"></a>ci(y, hy_dense)</span>
<span id="cb45-312"><a href="#cb45-312" aria-hidden="true" tabindex="-1"></a>df_dense <span class="op">=</span> pd.DataFrame(ci.statistic_samples, columns<span class="op">=</span>[<span class="st">'f1-neg'</span>, <span class="st">'f1-pos'</span>])</span>
<span id="cb45-313"><a href="#cb45-313" aria-hidden="true" tabindex="-1"></a>df_dense[<span class="st">'Tipo'</span>] <span class="op">=</span> <span class="st">'Dense'</span></span>
<span id="cb45-314"><a href="#cb45-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-315"><a href="#cb45-315" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> df_bow.melt(id_vars<span class="op">=</span>[<span class="st">'Tipo'</span>], value_name<span class="op">=</span><span class="st">'value'</span>, var_name<span class="op">=</span><span class="st">'f1'</span>)</span>
<span id="cb45-316"><a href="#cb45-316" aria-hidden="true" tabindex="-1"></a>_2 <span class="op">=</span> df_dense.melt(id_vars<span class="op">=</span>[<span class="st">'Tipo'</span>], value_name<span class="op">=</span><span class="st">'value'</span>, var_name<span class="op">=</span><span class="st">'f1'</span>)</span>
<span id="cb45-317"><a href="#cb45-317" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> pd.concat((_, _2))</span>
<span id="cb45-318"><a href="#cb45-318" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"whitegrid"</span>)</span>
<span id="cb45-319"><a href="#cb45-319" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> sns.displot(_, x<span class="op">=</span><span class="st">'value'</span>, hue<span class="op">=</span><span class="st">'f1'</span>, kde<span class="op">=</span><span class="va">True</span>, col<span class="op">=</span><span class="st">'Tipo'</span>)</span>
<span id="cb45-320"><a href="#cb45-320" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;plt.grid()</span></span>
<span id="cb45-321"><a href="#cb45-321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-322"><a href="#cb45-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-323"><a href="#cb45-323" aria-hidden="true" tabindex="-1"></a>En un clasificador basado en palabras densas también se puede comprender su comportamiento mostrando aquellas características que tiene un mayor peso al momento de decidir la clase. En las siguientes instrucciones se agrupan las características positivas y las negativas, utilizando el valor estimado por la máquina de soporte vectorial lineal (<span class="in">`w`</span>). Considerando que cada característica está asociada a una palabra o emoji, entonces se pueden visualizar mediante una nube de palabras.</span>
<span id="cb45-324"><a href="#cb45-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-327"><a href="#cb45-327" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-328"><a href="#cb45-328" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb45-329"><a href="#cb45-329" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> dense.estimator_instance.coef_[<span class="dv">0</span>]</span>
<span id="cb45-330"><a href="#cb45-330" aria-hidden="true" tabindex="-1"></a>names <span class="op">=</span> np.array(dense.names)</span>
<span id="cb45-331"><a href="#cb45-331" aria-hidden="true" tabindex="-1"></a>carac_pos <span class="op">=</span> {k: v <span class="cf">for</span> k, v <span class="kw">in</span> <span class="bu">zip</span>(names, w) <span class="cf">if</span> v <span class="op">&gt;</span> <span class="dv">0</span>}</span>
<span id="cb45-332"><a href="#cb45-332" aria-hidden="true" tabindex="-1"></a>carac_neg <span class="op">=</span> {k: v <span class="op">*</span> <span class="op">-</span><span class="dv">1</span> <span class="cf">for</span> k, v <span class="kw">in</span> <span class="bu">zip</span>(names, w) <span class="cf">if</span> v <span class="op">&lt;</span> <span class="dv">0</span>}</span>
<span id="cb45-333"><a href="#cb45-333" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-334"><a href="#cb45-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-335"><a href="#cb45-335" aria-hidden="true" tabindex="-1"></a>La @fig-nube-densa muestra las nubes de palabras de las características positivas y negativas, se puede observar que una característica significativa de la clase positiva corresponde al modelo **robo**, **muere**, entre otros y de la clase negativa se observa **comentando**, **ocurrir*, entre otras. </span>
<span id="cb45-336"><a href="#cb45-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-339"><a href="#cb45-339" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-340"><a href="#cb45-340" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb45-341"><a href="#cb45-341" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Nube de características positivas y negativas</span></span>
<span id="cb45-342"><a href="#cb45-342" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-nube-densa</span></span>
<span id="cb45-343"><a href="#cb45-343" aria-hidden="true" tabindex="-1"></a>word_pos <span class="op">=</span> WordCloud().generate_from_frequencies(carac_pos)</span>
<span id="cb45-344"><a href="#cb45-344" aria-hidden="true" tabindex="-1"></a>word_neg <span class="op">=</span> WordCloud().generate_from_frequencies(carac_neg)</span>
<span id="cb45-345"><a href="#cb45-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-346"><a href="#cb45-346" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb45-347"><a href="#cb45-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-348"><a href="#cb45-348" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cloud, ax, title <span class="kw">in</span> <span class="bu">zip</span>([word_neg, word_pos],</span>
<span id="cb45-349"><a href="#cb45-349" aria-hidden="true" tabindex="-1"></a>                     [ax1, ax2],</span>
<span id="cb45-350"><a href="#cb45-350" aria-hidden="true" tabindex="-1"></a>                     [<span class="st">'Negativas'</span>, <span class="st">'Positivas'</span>]):</span>
<span id="cb45-351"><a href="#cb45-351" aria-hidden="true" tabindex="-1"></a>    ax.imshow(cloud, interpolation<span class="op">=</span><span class="st">'bilinear'</span>)</span>
<span id="cb45-352"><a href="#cb45-352" aria-hidden="true" tabindex="-1"></a>    ax.grid(<span class="va">False</span>)</span>
<span id="cb45-353"><a href="#cb45-353" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(left<span class="op">=</span><span class="va">False</span>, right<span class="op">=</span><span class="va">False</span>, labelleft<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb45-354"><a href="#cb45-354" aria-hidden="true" tabindex="-1"></a>                   labelbottom<span class="op">=</span><span class="va">False</span>, bottom<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb45-355"><a href="#cb45-355" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title)</span>
<span id="cb45-356"><a href="#cb45-356" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-357"><a href="#cb45-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-358"><a href="#cb45-358" aria-hidden="true" tabindex="-1"></a><span class="fu">## Análisis Mediante Ejemplos {#sec-analisis-ejemplo}</span></span>
<span id="cb45-359"><a href="#cb45-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-360"><a href="#cb45-360" aria-hidden="true" tabindex="-1"></a>Hasta el momento se ha presentado un análisis global de los clasificadores dispersos (<span class="in">`bow`</span>) y densos (<span class="in">`dense`</span>), en esta sección se especializa el análisis al nivel de ejemplos. Lo primero que se realiza es ver el valor de la función de decisión, el signo de este valor indica la clase, un valor positivo indica clase positiva y el signo negativo corresponde a la clase negativa. El valor absoluto de la función indica de manera proporcional la distancia que existe al hiperplano que define las clases. Dado que se está utilizando este valor para contrastar el comportamiento de los algoritmos entonces la distancia entre el ejemplo al hiperplano está dado por la función de decisión dividida entre la norma de los coeficientes. La primera línea calcula la norma de los coeficientes estimados tanto para el clasificador disperso (<span class="in">`bow_norm`</span>) y el denso (<span class="in">`dense_norm`</span>)</span>
<span id="cb45-361"><a href="#cb45-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-364"><a href="#cb45-364" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-365"><a href="#cb45-365" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb45-366"><a href="#cb45-366" aria-hidden="true" tabindex="-1"></a>bow_norm <span class="op">=</span> np.linalg.norm(bow.estimator_instance.coef_[<span class="dv">0</span>])</span>
<span id="cb45-367"><a href="#cb45-367" aria-hidden="true" tabindex="-1"></a>dense_norm <span class="op">=</span> np.linalg.norm(dense.estimator_instance.coef_[<span class="dv">0</span>])</span>
<span id="cb45-368"><a href="#cb45-368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-369"><a href="#cb45-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-370"><a href="#cb45-370" aria-hidden="true" tabindex="-1"></a>Con las normas se procederá a calcular la función de decisión para el ejemplo *Asesinan a persona en Jalisco*, este ejemplo es positivo dado que menciona la ocurrencia de un delito. En las siguientes instrucciones se calcula la distancia al hiperplano la cual se puede observar que es positiva indicando que el texto es positivo. </span>
<span id="cb45-371"><a href="#cb45-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-374"><a href="#cb45-374" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-375"><a href="#cb45-375" aria-hidden="true" tabindex="-1"></a>txt <span class="op">=</span> <span class="st">'Asesinan a persona en Jalisco.'</span></span>
<span id="cb45-376"><a href="#cb45-376" aria-hidden="true" tabindex="-1"></a>bow.decision_function([txt]) <span class="op">/</span> bow_norm</span>
<span id="cb45-377"><a href="#cb45-377" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-378"><a href="#cb45-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-379"><a href="#cb45-379" aria-hidden="true" tabindex="-1"></a>Complementando la distancia del clasificador disperso se presenta la distancia del clasificador denso en el siguiente código. También se puede observar que su valor es positivo, pero este se encuentre más cercano al hiperplano de decisión, lo cual indica que existe una mayor incertidumbre en su clase. </span>
<span id="cb45-380"><a href="#cb45-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-383"><a href="#cb45-383" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-384"><a href="#cb45-384" aria-hidden="true" tabindex="-1"></a>dense.decision_function([txt]) <span class="op">/</span> dense_norm</span>
<span id="cb45-385"><a href="#cb45-385" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-386"><a href="#cb45-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-387"><a href="#cb45-387" aria-hidden="true" tabindex="-1"></a>Realizando el mismo procedimiento pero para texto *La asesina vivía en Jalisco.* Lo primero que se debe de notar es que el texto es negativo dado que se menciona que existe una asesina, pero el texto no indica que se haya cometido algún delito, esta fue una de las reglas que se siguió para etiquetar los textos tanto del conjunto de entrenamiento ($\mathcal T$) como del conjunto de prueba ($\mathcal G$). Pero es evidente que el texto anterior y el actual son sintácticamente muy similares, pero con una semántica diferente. </span>
<span id="cb45-388"><a href="#cb45-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-389"><a href="#cb45-389" aria-hidden="true" tabindex="-1"></a>El siguiente código predice la función de decisión del clasificador disperso, la distancia es el valor absoluto del número presentado y el signo indica el lado del hiperplano, se observa que es negativo, entonces el clasificador indica que pertenece a la clase negativa. </span>
<span id="cb45-390"><a href="#cb45-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-391"><a href="#cb45-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-394"><a href="#cb45-394" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-395"><a href="#cb45-395" aria-hidden="true" tabindex="-1"></a>txt <span class="op">=</span> <span class="st">'La asesina vivía en Jalisco.'</span></span>
<span id="cb45-396"><a href="#cb45-396" aria-hidden="true" tabindex="-1"></a>bow.decision_function([txt]) <span class="op">/</span> bow_norm</span>
<span id="cb45-397"><a href="#cb45-397" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-398"><a href="#cb45-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-399"><a href="#cb45-399" aria-hidden="true" tabindex="-1"></a>El mismo procedimiento se realiza para el clasificador denso como se indica a continuación, obteniendo también un valor negativo y con una magnitud similar al encontrado por el clasificador disperso. </span>
<span id="cb45-400"><a href="#cb45-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-403"><a href="#cb45-403" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-404"><a href="#cb45-404" aria-hidden="true" tabindex="-1"></a>dense.decision_function([txt]) <span class="op">/</span> dense_norm</span>
<span id="cb45-405"><a href="#cb45-405" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-406"><a href="#cb45-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-407"><a href="#cb45-407" aria-hidden="true" tabindex="-1"></a>Continuando con el análisis, se puede visualizar los coeficientes más significativos para realizar la predicción. Por ejemplo, las siguientes instrucciones muestran los 5 coeficientes más significativos para predecir el texto *Asesinan a persona en Jalisco.*</span>
<span id="cb45-408"><a href="#cb45-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-409"><a href="#cb45-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-412"><a href="#cb45-412" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-413"><a href="#cb45-413" aria-hidden="true" tabindex="-1"></a>txt <span class="op">=</span> <span class="st">'Asesinan a persona en Jalisco.'</span></span>
<span id="cb45-414"><a href="#cb45-414" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> bow.estimator_instance.coef_[<span class="dv">0</span>]</span>
<span id="cb45-415"><a href="#cb45-415" aria-hidden="true" tabindex="-1"></a>vec <span class="op">=</span> bow.bow[txt]</span>
<span id="cb45-416"><a href="#cb45-416" aria-hidden="true" tabindex="-1"></a><span class="bu">sorted</span>([(bow.names[k], w[k] <span class="op">*</span> v) <span class="cf">for</span> k, v <span class="kw">in</span> vec],</span>
<span id="cb45-417"><a href="#cb45-417" aria-hidden="true" tabindex="-1"></a>       key<span class="op">=</span><span class="kw">lambda</span> x: np.fabs(x[<span class="dv">1</span>]), reverse<span class="op">=</span><span class="va">True</span>)[:<span class="dv">5</span>]</span>
<span id="cb45-418"><a href="#cb45-418" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-419"><a href="#cb45-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-420"><a href="#cb45-420" aria-hidden="true" tabindex="-1"></a>Un procedimiento equivalente se realiza para el clasificador denso, tal y como se muestra en el siguiente código. </span>
<span id="cb45-421"><a href="#cb45-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-422"><a href="#cb45-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-425"><a href="#cb45-425" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-426"><a href="#cb45-426" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> dense.estimator_instance.coef_[<span class="dv">0</span>]</span>
<span id="cb45-427"><a href="#cb45-427" aria-hidden="true" tabindex="-1"></a>vec <span class="op">=</span> dense.transform([txt])[<span class="dv">0</span>] <span class="op">*</span> w</span>
<span id="cb45-428"><a href="#cb45-428" aria-hidden="true" tabindex="-1"></a><span class="bu">sorted</span>([(dense.names[k], v) <span class="cf">for</span> k, v <span class="kw">in</span> <span class="bu">enumerate</span>(vec)],</span>
<span id="cb45-429"><a href="#cb45-429" aria-hidden="true" tabindex="-1"></a>       key<span class="op">=</span><span class="kw">lambda</span> x: np.fabs(x[<span class="dv">1</span>]), reverse<span class="op">=</span><span class="va">True</span>)[:<span class="dv">5</span>]</span>
<span id="cb45-430"><a href="#cb45-430" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-431"><a href="#cb45-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-432"><a href="#cb45-432" aria-hidden="true" tabindex="-1"></a>La @fig-nube-ej-pos muestra la nube de palabras de los términos y características más significativas para la predicción del ejemplo positivo (*Asesinan a persona en Jalisco*). La nube de palabras para el ejemplo negativo (*La asesina vivía en Jalisco*) se muestra en la @fig-nube-ej. La nube de palabras está codificada de la siguiente manera, las palabras que corresponden a la clase positiva está en mayúsculas y las de la clase negativa en minúsculas. Por ejemplo, en @fig-nube-ej-pos se observa que la palabra *asesinan* es relevante para la clasificación del ejemplo así como la característica **ocurrir**.</span>
<span id="cb45-433"><a href="#cb45-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-434"><a href="#cb45-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-437"><a href="#cb45-437" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-438"><a href="#cb45-438" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb45-439"><a href="#cb45-439" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Nube de características ejemplo positivo</span></span>
<span id="cb45-440"><a href="#cb45-440" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-nube-ej-pos</span></span>
<span id="cb45-441"><a href="#cb45-441" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> codifica(names, vec):</span>
<span id="cb45-442"><a href="#cb45-442" aria-hidden="true" tabindex="-1"></a>    carac_pos <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb45-443"><a href="#cb45-443" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k, v <span class="kw">in</span> <span class="bu">zip</span>(names, vec):</span>
<span id="cb45-444"><a href="#cb45-444" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> v <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb45-445"><a href="#cb45-445" aria-hidden="true" tabindex="-1"></a>            key <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>k<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb45-446"><a href="#cb45-446" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb45-447"><a href="#cb45-447" aria-hidden="true" tabindex="-1"></a>            key <span class="op">=</span> k</span>
<span id="cb45-448"><a href="#cb45-448" aria-hidden="true" tabindex="-1"></a>        carac_pos[key] <span class="op">=</span> np.fabs(v)</span>
<span id="cb45-449"><a href="#cb45-449" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> carac_pos</span>
<span id="cb45-450"><a href="#cb45-450" aria-hidden="true" tabindex="-1"></a>txt <span class="op">=</span> <span class="st">'Asesinan a persona en Jalisco.'</span></span>
<span id="cb45-451"><a href="#cb45-451" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> dense.transform([txt])[<span class="dv">0</span>] <span class="op">*</span> dense.estimator_instance.coef_[<span class="dv">0</span>]</span>
<span id="cb45-452"><a href="#cb45-452" aria-hidden="true" tabindex="-1"></a>word_cloud_dense <span class="op">=</span> WordCloud().generate_from_frequencies(codifica(dense.names, _))</span>
<span id="cb45-453"><a href="#cb45-453" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb45-454"><a href="#cb45-454" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> bow.estimator_instance.coef_[<span class="dv">0</span>]</span>
<span id="cb45-455"><a href="#cb45-455" aria-hidden="true" tabindex="-1"></a>vec <span class="op">=</span> bow.bow[txt]</span>
<span id="cb45-456"><a href="#cb45-456" aria-hidden="true" tabindex="-1"></a>carac_pos <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb45-457"><a href="#cb45-457" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k, v <span class="kw">in</span> vec:</span>
<span id="cb45-458"><a href="#cb45-458" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> w[k] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb45-459"><a href="#cb45-459" aria-hidden="true" tabindex="-1"></a>        key <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>bow<span class="sc">.</span>names[k]<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb45-460"><a href="#cb45-460" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb45-461"><a href="#cb45-461" aria-hidden="true" tabindex="-1"></a>        key <span class="op">=</span> bow.names[k]</span>
<span id="cb45-462"><a href="#cb45-462" aria-hidden="true" tabindex="-1"></a>    carac_pos[key] <span class="op">=</span> np.fabs(v <span class="op">*</span> w[k])</span>
<span id="cb45-463"><a href="#cb45-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-464"><a href="#cb45-464" aria-hidden="true" tabindex="-1"></a>word_cloud <span class="op">=</span> WordCloud().generate_from_frequencies(carac_pos)</span>
<span id="cb45-465"><a href="#cb45-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-466"><a href="#cb45-466" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb45-467"><a href="#cb45-467" aria-hidden="true" tabindex="-1"></a>ax1.imshow(word_cloud, interpolation<span class="op">=</span><span class="st">'bilinear'</span>)</span>
<span id="cb45-468"><a href="#cb45-468" aria-hidden="true" tabindex="-1"></a>ax2.imshow(word_cloud_dense, interpolation<span class="op">=</span><span class="st">'bilinear'</span>)</span>
<span id="cb45-469"><a href="#cb45-469" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax, title <span class="kw">in</span> <span class="bu">zip</span>([ax1, ax2], [<span class="st">'BoW'</span>, <span class="st">'DenseBoW'</span>]):</span>
<span id="cb45-470"><a href="#cb45-470" aria-hidden="true" tabindex="-1"></a>    ax.grid(<span class="va">False</span>)</span>
<span id="cb45-471"><a href="#cb45-471" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(left<span class="op">=</span><span class="va">False</span>, right<span class="op">=</span><span class="va">False</span>, labelleft<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb45-472"><a href="#cb45-472" aria-hidden="true" tabindex="-1"></a>                   labelbottom<span class="op">=</span><span class="va">False</span>, bottom<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb45-473"><a href="#cb45-473" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title)</span>
<span id="cb45-474"><a href="#cb45-474" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-475"><a href="#cb45-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-476"><a href="#cb45-476" aria-hidden="true" tabindex="-1"></a>En el caso del ejemplo negativo, la @fig-nube-ej muestra q-gramas de caracteres asociados a la clase positiva y también es evidente la palabra *asesina*. En el caso del clasificador denso también se observan características positivas como **ocurrir** y características negativas como **critican** y **empleados**. </span>
<span id="cb45-477"><a href="#cb45-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-480"><a href="#cb45-480" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-481"><a href="#cb45-481" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb45-482"><a href="#cb45-482" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Nube de características ejemplo negativo</span></span>
<span id="cb45-483"><a href="#cb45-483" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-nube-ej</span></span>
<span id="cb45-484"><a href="#cb45-484" aria-hidden="true" tabindex="-1"></a>txt <span class="op">=</span> <span class="st">'La asesina vivía en Jalisco.'</span></span>
<span id="cb45-485"><a href="#cb45-485" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> dense.transform([txt])[<span class="dv">0</span>] <span class="op">*</span> dense.estimator_instance.coef_[<span class="dv">0</span>]</span>
<span id="cb45-486"><a href="#cb45-486" aria-hidden="true" tabindex="-1"></a>word_cloud_dense <span class="op">=</span> WordCloud().generate_from_frequencies(codifica(dense.names, _))</span>
<span id="cb45-487"><a href="#cb45-487" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb45-488"><a href="#cb45-488" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> bow.estimator_instance.coef_[<span class="dv">0</span>]</span>
<span id="cb45-489"><a href="#cb45-489" aria-hidden="true" tabindex="-1"></a>vec <span class="op">=</span> bow.bow[txt]</span>
<span id="cb45-490"><a href="#cb45-490" aria-hidden="true" tabindex="-1"></a>carac_pos <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb45-491"><a href="#cb45-491" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k, v <span class="kw">in</span> vec:</span>
<span id="cb45-492"><a href="#cb45-492" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> w[k] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb45-493"><a href="#cb45-493" aria-hidden="true" tabindex="-1"></a>        key <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>bow<span class="sc">.</span>names[k]<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb45-494"><a href="#cb45-494" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb45-495"><a href="#cb45-495" aria-hidden="true" tabindex="-1"></a>        key <span class="op">=</span> bow.names[k]</span>
<span id="cb45-496"><a href="#cb45-496" aria-hidden="true" tabindex="-1"></a>    carac_pos[key] <span class="op">=</span> np.fabs(v <span class="op">*</span> w[k])</span>
<span id="cb45-497"><a href="#cb45-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-498"><a href="#cb45-498" aria-hidden="true" tabindex="-1"></a>word_cloud <span class="op">=</span> WordCloud().generate_from_frequencies(carac_pos)</span>
<span id="cb45-499"><a href="#cb45-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-500"><a href="#cb45-500" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb45-501"><a href="#cb45-501" aria-hidden="true" tabindex="-1"></a>ax1.imshow(word_cloud, interpolation<span class="op">=</span><span class="st">'bilinear'</span>)</span>
<span id="cb45-502"><a href="#cb45-502" aria-hidden="true" tabindex="-1"></a>ax2.imshow(word_cloud_dense, interpolation<span class="op">=</span><span class="st">'bilinear'</span>)</span>
<span id="cb45-503"><a href="#cb45-503" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax, title <span class="kw">in</span> <span class="bu">zip</span>([ax1, ax2], [<span class="st">'BoW'</span>, <span class="st">'DenseBoW'</span>]):</span>
<span id="cb45-504"><a href="#cb45-504" aria-hidden="true" tabindex="-1"></a>    ax.grid(<span class="va">False</span>)</span>
<span id="cb45-505"><a href="#cb45-505" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(left<span class="op">=</span><span class="va">False</span>, right<span class="op">=</span><span class="va">False</span>, labelleft<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb45-506"><a href="#cb45-506" aria-hidden="true" tabindex="-1"></a>                   labelbottom<span class="op">=</span><span class="va">False</span>, bottom<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb45-507"><a href="#cb45-507" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title)</span>
<span id="cb45-508"><a href="#cb45-508" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-509"><a href="#cb45-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-512"><a href="#cb45-512" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-513"><a href="#cb45-513" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb45-514"><a href="#cb45-514" aria-hidden="true" tabindex="-1"></a>txt <span class="op">=</span> <span class="st">'Le acaban de robar la bicicleta a mi hijo.'</span></span>
<span id="cb45-515"><a href="#cb45-515" aria-hidden="true" tabindex="-1"></a>df_bow <span class="op">=</span> bow.decision_function([txt])[<span class="dv">0</span>, <span class="dv">0</span>] <span class="op">/</span> bow_norm</span>
<span id="cb45-516"><a href="#cb45-516" aria-hidden="true" tabindex="-1"></a>df_dense <span class="op">=</span> dense.decision_function([txt])[<span class="dv">0</span>, <span class="dv">0</span>] <span class="op">/</span> dense_norm</span>
<span id="cb45-517"><a href="#cb45-517" aria-hidden="true" tabindex="-1"></a>bow_f <span class="op">=</span> Markdown(<span class="ss">f'$</span><span class="sc">{</span>df_bow<span class="sc">:0.4f}</span><span class="ss">$'</span>)</span>
<span id="cb45-518"><a href="#cb45-518" aria-hidden="true" tabindex="-1"></a>dense_f <span class="op">=</span> Markdown(<span class="ss">f'$</span><span class="sc">{</span>df_dense<span class="sc">:0.4f}</span><span class="ss">$'</span>)</span>
<span id="cb45-519"><a href="#cb45-519" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-520"><a href="#cb45-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-521"><a href="#cb45-521" aria-hidden="true" tabindex="-1"></a>Complementando los ejemplos anteriores, la @fig-nube-ej-error muestra la nube de palabras obtenidas al calcular la función de decisión del texto *Le acaban de robar la bicicleta a mi hijo.* Se observa que este texto corresponde a la clase positiva y la función de decisión normalizada del clasificador disperso es <span class="in">`{python} bow_f`</span> y del clasificador denso corresponde a <span class="in">`{python} dense_f`</span>. Ambas funciones de decisión indican que la clase es negativa, lo cual es un error. La figura muestra que los q-gramas de caracteres y las características positivas dominan las nubes, pero estas no tienen el peso suficiente para realizar una predicción correcta. </span>
<span id="cb45-522"><a href="#cb45-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-525"><a href="#cb45-525" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-526"><a href="#cb45-526" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb45-527"><a href="#cb45-527" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Nube de características en un ejemplo positivo con predicción negativa</span></span>
<span id="cb45-528"><a href="#cb45-528" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-nube-ej-error</span></span>
<span id="cb45-529"><a href="#cb45-529" aria-hidden="true" tabindex="-1"></a>txt <span class="op">=</span> <span class="st">'Le acaban de robar la bicicleta a mi hijo.'</span></span>
<span id="cb45-530"><a href="#cb45-530" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> dense.transform([txt])[<span class="dv">0</span>] <span class="op">*</span> dense.estimator_instance.coef_[<span class="dv">0</span>]</span>
<span id="cb45-531"><a href="#cb45-531" aria-hidden="true" tabindex="-1"></a>word_cloud_dense <span class="op">=</span> WordCloud().generate_from_frequencies(codifica(dense.names, _))</span>
<span id="cb45-532"><a href="#cb45-532" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb45-533"><a href="#cb45-533" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> bow.estimator_instance.coef_[<span class="dv">0</span>]</span>
<span id="cb45-534"><a href="#cb45-534" aria-hidden="true" tabindex="-1"></a>vec <span class="op">=</span> bow.bow[txt]</span>
<span id="cb45-535"><a href="#cb45-535" aria-hidden="true" tabindex="-1"></a>carac_pos <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb45-536"><a href="#cb45-536" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k, v <span class="kw">in</span> vec:</span>
<span id="cb45-537"><a href="#cb45-537" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> w[k] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb45-538"><a href="#cb45-538" aria-hidden="true" tabindex="-1"></a>        key <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>bow<span class="sc">.</span>names[k]<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb45-539"><a href="#cb45-539" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb45-540"><a href="#cb45-540" aria-hidden="true" tabindex="-1"></a>        key <span class="op">=</span> bow.names[k]</span>
<span id="cb45-541"><a href="#cb45-541" aria-hidden="true" tabindex="-1"></a>    carac_pos[key] <span class="op">=</span> np.fabs(v <span class="op">*</span> w[k])</span>
<span id="cb45-542"><a href="#cb45-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-543"><a href="#cb45-543" aria-hidden="true" tabindex="-1"></a>word_cloud <span class="op">=</span> WordCloud().generate_from_frequencies(carac_pos)</span>
<span id="cb45-544"><a href="#cb45-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-545"><a href="#cb45-545" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb45-546"><a href="#cb45-546" aria-hidden="true" tabindex="-1"></a>ax1.imshow(word_cloud, interpolation<span class="op">=</span><span class="st">'bilinear'</span>)</span>
<span id="cb45-547"><a href="#cb45-547" aria-hidden="true" tabindex="-1"></a>ax2.imshow(word_cloud_dense, interpolation<span class="op">=</span><span class="st">'bilinear'</span>)</span>
<span id="cb45-548"><a href="#cb45-548" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax, title <span class="kw">in</span> <span class="bu">zip</span>([ax1, ax2], [<span class="st">'BoW'</span>, <span class="st">'DenseBoW'</span>]):</span>
<span id="cb45-549"><a href="#cb45-549" aria-hidden="true" tabindex="-1"></a>    ax.grid(<span class="va">False</span>)</span>
<span id="cb45-550"><a href="#cb45-550" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(left<span class="op">=</span><span class="va">False</span>, right<span class="op">=</span><span class="va">False</span>, labelleft<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb45-551"><a href="#cb45-551" aria-hidden="true" tabindex="-1"></a>                   labelbottom<span class="op">=</span><span class="va">False</span>, bottom<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb45-552"><a href="#cb45-552" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title)</span>
<span id="cb45-553"><a href="#cb45-553" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-554"><a href="#cb45-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-555"><a href="#cb45-555" aria-hidden="true" tabindex="-1"></a><span class="fu">## Combinando Modelos</span></span>
<span id="cb45-556"><a href="#cb45-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-557"><a href="#cb45-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-560"><a href="#cb45-560" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb45-561"><a href="#cb45-561" aria-hidden="true" tabindex="-1"></a><span class="in">%%| echo: false</span></span>
<span id="cb45-562"><a href="#cb45-562" aria-hidden="true" tabindex="-1"></a><span class="in">%%| fig-cap: Diagrama de predicción en mezcla de modelos</span></span>
<span id="cb45-563"><a href="#cb45-563" aria-hidden="true" tabindex="-1"></a><span class="in">%%| label: fig-prediccion-1-estimador</span></span>
<span id="cb45-564"><a href="#cb45-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-565"><a href="#cb45-565" aria-hidden="true" tabindex="-1"></a><span class="in">flowchart TB</span></span>
<span id="cb45-566"><a href="#cb45-566" aria-hidden="true" tabindex="-1"></a><span class="in">    Conc[Concatenación]</span></span>
<span id="cb45-567"><a href="#cb45-567" aria-hidden="true" tabindex="-1"></a><span class="in">    Representación --&gt; Estimadores --&gt; Conc</span></span>
<span id="cb45-568"><a href="#cb45-568" aria-hidden="true" tabindex="-1"></a><span class="in">    Conc --&gt; Predicción</span></span>
<span id="cb45-569"><a href="#cb45-569" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph Representación [Representaciones]</span></span>
<span id="cb45-570"><a href="#cb45-570" aria-hidden="true" tabindex="-1"></a><span class="in">        direction TB</span></span>
<span id="cb45-571"><a href="#cb45-571" aria-hidden="true" tabindex="-1"></a><span class="in">        Repr1([Representación 1])</span></span>
<span id="cb45-572"><a href="#cb45-572" aria-hidden="true" tabindex="-1"></a><span class="in">        Repr2([Representación 2])</span></span>
<span id="cb45-573"><a href="#cb45-573" aria-hidden="true" tabindex="-1"></a><span class="in">        ReprI([...])</span></span>
<span id="cb45-574"><a href="#cb45-574" aria-hidden="true" tabindex="-1"></a><span class="in">        ReprM([Representación M])</span></span>
<span id="cb45-575"><a href="#cb45-575" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb45-576"><a href="#cb45-576" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph Estimadores</span></span>
<span id="cb45-577"><a href="#cb45-577" aria-hidden="true" tabindex="-1"></a><span class="in">        direction TB    </span></span>
<span id="cb45-578"><a href="#cb45-578" aria-hidden="true" tabindex="-1"></a><span class="in">        Est1[Estimador 1] </span></span>
<span id="cb45-579"><a href="#cb45-579" aria-hidden="true" tabindex="-1"></a><span class="in">        Est2[Estimador 2]</span></span>
<span id="cb45-580"><a href="#cb45-580" aria-hidden="true" tabindex="-1"></a><span class="in">        EstI[...]</span></span>
<span id="cb45-581"><a href="#cb45-581" aria-hidden="true" tabindex="-1"></a><span class="in">        EstM[Estimador M]</span></span>
<span id="cb45-582"><a href="#cb45-582" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb45-583"><a href="#cb45-583" aria-hidden="true" tabindex="-1"></a><span class="in">    subgraph Predicción [Etapa de Predicción]</span></span>
<span id="cb45-584"><a href="#cb45-584" aria-hidden="true" tabindex="-1"></a><span class="in">        direction TB</span></span>
<span id="cb45-585"><a href="#cb45-585" aria-hidden="true" tabindex="-1"></a><span class="in">        Entrada</span></span>
<span id="cb45-586"><a href="#cb45-586" aria-hidden="true" tabindex="-1"></a><span class="in">        Entrada -- Clasificación --&gt; Clasificador[Clasificador]</span></span>
<span id="cb45-587"><a href="#cb45-587" aria-hidden="true" tabindex="-1"></a><span class="in">        Entrada -- Regresión --&gt; Regresor[Regresor]</span></span>
<span id="cb45-588"><a href="#cb45-588" aria-hidden="true" tabindex="-1"></a><span class="in">        Clasificador --&gt; Prediccion([Predicción])</span></span>
<span id="cb45-589"><a href="#cb45-589" aria-hidden="true" tabindex="-1"></a><span class="in">        Regresor --&gt; Prediccion</span></span>
<span id="cb45-590"><a href="#cb45-590" aria-hidden="true" tabindex="-1"></a><span class="in">    end</span></span>
<span id="cb45-591"><a href="#cb45-591" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-592"><a href="#cb45-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-593"><a href="#cb45-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-594"><a href="#cb45-594" aria-hidden="true" tabindex="-1"></a>La siguiente pregunta es conocer si los modelos anteriores se pueden combinar para realizar una mejor predicción. En esta sección se utiliza la técnica de Stack Generalization (@Wolpert1992StackedGeneralization, @EvoMSA) para combinar los dos modelos. La siguiente linea entrena el clasificador, el cual recibe como parámetros los clasificador a juntar. </span>
<span id="cb45-595"><a href="#cb45-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-598"><a href="#cb45-598" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-599"><a href="#cb45-599" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb45-600"><a href="#cb45-600" aria-hidden="true" tabindex="-1"></a>stack <span class="op">=</span> StackGeneralization([bow, dense]).fit(D)</span>
<span id="cb45-601"><a href="#cb45-601" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-602"><a href="#cb45-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-603"><a href="#cb45-603" aria-hidden="true" tabindex="-1"></a>Siguiendo el procedimiento de los clasificadores dispersos y densos, la siguiente linea predice la clase de los ejemplos del conjunto de prueba y calcula su rendimiento en términos de la medida $f_1$.</span>
<span id="cb45-604"><a href="#cb45-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-605"><a href="#cb45-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-608"><a href="#cb45-608" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-609"><a href="#cb45-609" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb45-610"><a href="#cb45-610" aria-hidden="true" tabindex="-1"></a>hy_stack <span class="op">=</span> stack.predict(Dtest)</span>
<span id="cb45-611"><a href="#cb45-611" aria-hidden="true" tabindex="-1"></a>f1_score(y, hy_stack, average<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb45-612"><a href="#cb45-612" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-613"><a href="#cb45-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-614"><a href="#cb45-614" aria-hidden="true" tabindex="-1"></a>Para poder comparar el rendimiento de los tres clasificadores desarrollados, la @tbl-performance-recall-precision-delitos presenta el rendimiento con las medidas recall y precision en las dos clases. Se puede observar que el <span class="in">`bow`</span> tiene el mejor recall en la clase negativa y mejor precision en la clase positiva. Por otro lado el mejor recall en la clase positiva y precision en la clase negativa lo tiene <span class="in">`stack`</span>.</span>
<span id="cb45-615"><a href="#cb45-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-618"><a href="#cb45-618" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-619"><a href="#cb45-619" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-performance-recall-precision-delitos</span></span>
<span id="cb45-620"><a href="#cb45-620" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: Rendimiento</span></span>
<span id="cb45-621"><a href="#cb45-621" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb45-622"><a href="#cb45-622" aria-hidden="true" tabindex="-1"></a>headers <span class="op">=</span> <span class="st">'|              |   Recall neg |&nbsp;Recall pos | Precision neg |&nbsp;Precision pos |'</span></span>
<span id="cb45-623"><a href="#cb45-623" aria-hidden="true" tabindex="-1"></a>linea <span class="op">=</span>   <span class="st">'|--------------|--------------|------------|---------------|---------------|'</span></span>
<span id="cb45-624"><a href="#cb45-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-625"><a href="#cb45-625" aria-hidden="true" tabindex="-1"></a>recall_bow <span class="op">=</span> recall_score(y, hy_bow, average<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb45-626"><a href="#cb45-626" aria-hidden="true" tabindex="-1"></a>recall_dense <span class="op">=</span> recall_score(y, hy_dense, average<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb45-627"><a href="#cb45-627" aria-hidden="true" tabindex="-1"></a>recall_stack <span class="op">=</span> recall_score(y, hy_stack, average<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb45-628"><a href="#cb45-628" aria-hidden="true" tabindex="-1"></a>pr_bow <span class="op">=</span> precision_score(y, hy_bow, average<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb45-629"><a href="#cb45-629" aria-hidden="true" tabindex="-1"></a>pr_dense <span class="op">=</span> precision_score(y, hy_dense, average<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb45-630"><a href="#cb45-630" aria-hidden="true" tabindex="-1"></a>pr_stack <span class="op">=</span> precision_score(y, hy_stack, average<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb45-631"><a href="#cb45-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-632"><a href="#cb45-632" aria-hidden="true" tabindex="-1"></a>recall_bow_f <span class="op">=</span> <span class="st">' | '</span>.join([<span class="ss">f'$</span><span class="sc">{</span>x<span class="sc">:0.4f}</span><span class="ss">$'</span> <span class="cf">for</span> x <span class="kw">in</span> np.r_[recall_bow, pr_bow]])</span>
<span id="cb45-633"><a href="#cb45-633" aria-hidden="true" tabindex="-1"></a>recall_dense_f <span class="op">=</span> <span class="st">' | '</span>.join([<span class="ss">f'$</span><span class="sc">{</span>x<span class="sc">:0.4f}</span><span class="ss">$'</span> <span class="cf">for</span> x <span class="kw">in</span> np.r_[recall_dense, pr_dense]])</span>
<span id="cb45-634"><a href="#cb45-634" aria-hidden="true" tabindex="-1"></a>recall_stack_f <span class="op">=</span> <span class="st">' | '</span>.join([<span class="ss">f'$</span><span class="sc">{</span>x<span class="sc">:0.4f}</span><span class="ss">$'</span> <span class="cf">for</span> x <span class="kw">in</span> np.r_[recall_stack, pr_stack]])</span>
<span id="cb45-635"><a href="#cb45-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-636"><a href="#cb45-636" aria-hidden="true" tabindex="-1"></a>tab <span class="op">=</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>.join(([headers, linea,</span>
<span id="cb45-637"><a href="#cb45-637" aria-hidden="true" tabindex="-1"></a>                  <span class="ss">f'|`bow`|</span><span class="sc">{</span>recall_bow_f<span class="sc">}</span><span class="ss">|'</span>,</span>
<span id="cb45-638"><a href="#cb45-638" aria-hidden="true" tabindex="-1"></a>                  <span class="ss">f'|`dense`|</span><span class="sc">{</span>recall_dense_f<span class="sc">}</span><span class="ss">|'</span>,</span>
<span id="cb45-639"><a href="#cb45-639" aria-hidden="true" tabindex="-1"></a>                  <span class="ss">f'|`stack`|</span><span class="sc">{</span>recall_stack_f<span class="sc">}</span><span class="ss">|'</span>]))</span>
<span id="cb45-640"><a href="#cb45-640" aria-hidden="true" tabindex="-1"></a>Markdown(tab)</span>
<span id="cb45-641"><a href="#cb45-641" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-642"><a href="#cb45-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-643"><a href="#cb45-643" aria-hidden="true" tabindex="-1"></a>Con respecto al rendimiento en términos de $f_1$, la @tbl-performance-f1-delitos presenta la información con respecto a cada clase y la última columna contiene el macro-$f_1$. Los valores indican que en la clase positiva el mejor valor corresponde a <span class="in">`stack`</span> lo cual se ve reflejado en el macro-$f_1$. El algoritmo de Stack Generalization nos indica que se hizo una mejora en la predicción de la clase positiva y la clase negativa se mantuvo constante al menos con respecto de la medida $f_1$.</span>
<span id="cb45-644"><a href="#cb45-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-645"><a href="#cb45-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-648"><a href="#cb45-648" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb45-649"><a href="#cb45-649" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-performance-f1-delitos</span></span>
<span id="cb45-650"><a href="#cb45-650" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: Rendimiento</span></span>
<span id="cb45-651"><a href="#cb45-651" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb45-652"><a href="#cb45-652" aria-hidden="true" tabindex="-1"></a>headers <span class="op">=</span> <span class="st">'|              | f1 neg |&nbsp;f1 pos | macro-f1 |'</span></span>
<span id="cb45-653"><a href="#cb45-653" aria-hidden="true" tabindex="-1"></a>linea <span class="op">=</span>   <span class="st">'|--------------|--------|--------|----------|'</span></span>
<span id="cb45-654"><a href="#cb45-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-655"><a href="#cb45-655" aria-hidden="true" tabindex="-1"></a>f1_bow <span class="op">=</span>   f1_score(y, hy_bow, average<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb45-656"><a href="#cb45-656" aria-hidden="true" tabindex="-1"></a>f1_dense <span class="op">=</span> f1_score(y, hy_dense, average<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb45-657"><a href="#cb45-657" aria-hidden="true" tabindex="-1"></a>f1_stack <span class="op">=</span> f1_score(y, hy_stack, average<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb45-658"><a href="#cb45-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-659"><a href="#cb45-659" aria-hidden="true" tabindex="-1"></a>f1_macro_bow <span class="op">=</span>   f1_score(y, hy_bow,   average<span class="op">=</span><span class="st">"macro"</span>)</span>
<span id="cb45-660"><a href="#cb45-660" aria-hidden="true" tabindex="-1"></a>f1_macro_dense <span class="op">=</span> f1_score(y, hy_dense, average<span class="op">=</span><span class="st">"macro"</span>)</span>
<span id="cb45-661"><a href="#cb45-661" aria-hidden="true" tabindex="-1"></a>f1_macro_stack <span class="op">=</span> f1_score(y, hy_stack, average<span class="op">=</span><span class="st">"macro"</span>)</span>
<span id="cb45-662"><a href="#cb45-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-663"><a href="#cb45-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-664"><a href="#cb45-664" aria-hidden="true" tabindex="-1"></a>recall_bow_f <span class="op">=</span> <span class="st">' | '</span>.join([<span class="ss">f'$</span><span class="sc">{</span>x<span class="sc">:0.4f}</span><span class="ss">$'</span> <span class="cf">for</span> x <span class="kw">in</span>   np.r_[f1_bow, f1_macro_bow]])</span>
<span id="cb45-665"><a href="#cb45-665" aria-hidden="true" tabindex="-1"></a>recall_dense_f <span class="op">=</span> <span class="st">' | '</span>.join([<span class="ss">f'$</span><span class="sc">{</span>x<span class="sc">:0.4f}</span><span class="ss">$'</span> <span class="cf">for</span> x <span class="kw">in</span> np.r_[f1_dense, f1_macro_dense]])</span>
<span id="cb45-666"><a href="#cb45-666" aria-hidden="true" tabindex="-1"></a>recall_stack_f <span class="op">=</span> <span class="st">' | '</span>.join([<span class="ss">f'$</span><span class="sc">{</span>x<span class="sc">:0.4f}</span><span class="ss">$'</span> <span class="cf">for</span> x <span class="kw">in</span> np.r_[f1_stack, f1_macro_stack]])</span>
<span id="cb45-667"><a href="#cb45-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-668"><a href="#cb45-668" aria-hidden="true" tabindex="-1"></a>tab <span class="op">=</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>.join(([headers, linea,</span>
<span id="cb45-669"><a href="#cb45-669" aria-hidden="true" tabindex="-1"></a>                  <span class="ss">f'|`bow`|</span><span class="sc">{</span>recall_bow_f<span class="sc">}</span><span class="ss">|'</span>,</span>
<span id="cb45-670"><a href="#cb45-670" aria-hidden="true" tabindex="-1"></a>                  <span class="ss">f'|`dense`|</span><span class="sc">{</span>recall_dense_f<span class="sc">}</span><span class="ss">|'</span>,</span>
<span id="cb45-671"><a href="#cb45-671" aria-hidden="true" tabindex="-1"></a>                  <span class="ss">f'|`stack`|</span><span class="sc">{</span>recall_stack_f<span class="sc">}</span><span class="ss">|'</span>]))</span>
<span id="cb45-672"><a href="#cb45-672" aria-hidden="true" tabindex="-1"></a>Markdown(tab)</span>
<span id="cb45-673"><a href="#cb45-673" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p><a href="http://creativecommons.org/licenses/by-sa/4.0/"><img src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" class="img-fluid"></a> <br> Esta obra está bajo una <a href="http://creativecommons.org/licenses/by-sa/4.0/">Licencia Creative Commons Atribución-CompartirIgual 4.0 Internacional</a></p>
</div>
  </div>
</footer>




</body></html>